<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-48TH6Q1G8J"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-48TH6Q1G8J');
    </script>
    <!-- Microsoft Clarity -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "vd74xl3h1g");
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Glowmi â€” Glow starts with me | K-Beauty Skin Quiz, Personal Color Test & Clinic Finder</title>
    <meta name="description" content="Glowmi is your personal K-Beauty companion. Take our skin type quiz, discover your personal color season, browse Korean dermatology clinics in Gangnam, and learn about popular aesthetic procedures like Botox, filler, and laser treatments.">
    <meta name="keywords" content="Glowmi, K-Beauty, Korean skincare, skin type quiz, personal color test, Gangnam clinics, Korean dermatology, Botox Korea, filler Korea, laser toning, skin booster, K-Beauty guide for beginners">
    <meta name="author" content="Glowmi">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Glowmi â€” Glow starts with me | K-Beauty Guide">
    <meta property="og:description" content="Your personal K-Beauty companion. Find your skin type, discover your seasonal color palette, and explore top-rated clinics in Seoul.">
    <meta property="og:type" content="website">
    <meta name="google-adsense-account" content="ca-pub-7280155441452276">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âœ¨</text></svg>">
    <link rel="stylesheet" href="style.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7280155441452276"
     crossorigin="anonymous"></script>
    <script type="module">
        import { FaceLandmarker, FilesetResolver } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/vision_bundle.mjs";
        window.FaceLandmarker = FaceLandmarker;
        window.FilesetResolver = FilesetResolver;
    </script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>âœ¨ Glowmi</h1>
            <p class="subtitle">Glow starts with me | ë‚˜ë§Œì˜ K-ë·°í‹° ê°€ì´ë“œ</p>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="quiz">Quiz</button>
            <button class="tab-btn" data-tab="products">Products</button>
            <button class="tab-btn" data-tab="procedures">Clinics</button>
            <button class="tab-btn" data-tab="ai">AI Beauty</button>
            <button class="tab-btn" data-tab="wellness">Wellness</button>
        </nav>

        <!-- Tab Contents -->
        <main class="tab-content">
            <!-- Skin Quiz Tab -->
            <section id="quiz" class="tab-panel active">
                <!-- Quiz Season Select Screen -->
                <div id="quiz-season-select" class="quiz-screen">
                    <div class="quiz-intro-card">
                        <div class="quiz-icon">ğŸ”¬</div>
                        <h2>Find Your Skin Type</h2>
                        <h3>ë‚˜ì˜ í”¼ë¶€ íƒ€ì… ì°¾ê¸°</h3>
                        <p>Choose your season to get accurate skincare recommendations!</p>
                        <p class="korean">ì •í™•í•œ ìŠ¤í‚¨ì¼€ì–´ ì¶”ì²œì„ ìœ„í•´ ê³„ì ˆì„ ì„ íƒí•˜ì„¸ìš”!</p>
                        <div class="season-buttons">
                            <button class="season-btn summer-btn" onclick="selectSeason('summer')">
                                <span class="season-icon">â˜€ï¸</span>
                                <span class="season-name">Summer</span>
                                <span class="season-korean">ì—¬ë¦„</span>
                            </button>
                            <button class="season-btn winter-btn" onclick="selectSeason('winter')">
                                <span class="season-icon">â„ï¸</span>
                                <span class="season-name">Winter</span>
                                <span class="season-korean">ê²¨ìš¸</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quiz Start Screen -->
                <div id="quiz-start" class="quiz-screen hidden">
                    <div class="quiz-intro-card">
                        <div class="quiz-icon" id="season-quiz-icon">ğŸ”¬</div>
                        <h2 id="season-quiz-title">Find Your Skin Type</h2>
                        <h3 id="season-quiz-subtitle">ë‚˜ì˜ í”¼ë¶€ íƒ€ì… ì°¾ê¸°</h3>
                        <p id="season-quiz-desc">Answer 7 simple questions to discover your skin type and get personalized K-Beauty recommendations!</p>
                        <p class="korean" id="season-quiz-desc-kr">7ê°€ì§€ ê°„ë‹¨í•œ ì§ˆë¬¸ì— ë‹µí•˜ê³  ë‚˜ë§Œì˜ K-ë·°í‹° ì¶”ì²œì„ ë°›ì•„ë³´ì„¸ìš”!</p>
                        <button id="start-quiz-btn" class="primary-btn" onclick="startQuiz()">Start Quiz ì‹œì‘í•˜ê¸°</button>
                        <button id="back-to-season-btn" class="secondary-btn back-btn" onclick="backToSeasonSelect()">â† Back ë’¤ë¡œ</button>
                    </div>
                </div>

                <!-- Quiz Questions Screen -->
                <div id="quiz-questions" class="quiz-screen hidden">
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div id="progress-fill" class="progress-fill"></div>
                        </div>
                        <span id="progress-text" class="progress-text">1 / 7</span>
                    </div>
                    <div id="question-container" class="question-container"></div>
                </div>

                <!-- Quiz Result Screen -->
                <div id="quiz-result" class="quiz-screen hidden">
                    <div id="result-content" class="result-card"></div>
                </div>
            </section>

            <!-- Products Tab -->
            <section id="products" class="tab-panel hidden">
                <h2 class="section-title">K-Beauty Product Guide</h2>
                <p class="section-subtitle">K-ë·°í‹° ì œí’ˆ ê°€ì´ë“œ</p>

                <!-- Ingredient Analyzer Tool -->
                <div class="analyzer-tool">
                    <div class="analyzer-icon">ğŸ”¬</div>
                    <h3 class="analyzer-title">Ingredient Analyzer</h3>
                    <p class="analyzer-title-kr">ì„±ë¶„ ë¶„ì„ê¸°</p>
                    <p class="analyzer-desc">Paste an ingredient list or scan a product label with your camera.</p>
                    <textarea id="analyzer-input" class="analyzer-textarea" placeholder="Paste ingredient list hereâ€¦ e.g. Water, Glycerin, Niacinamide, ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ, ë ˆí‹°ë†€, â€¦" rows="4"></textarea>
                    <div class="analyzer-buttons">
                        <button class="primary-btn analyzer-btn" onclick="analyzeIngredients()">Analyze ë¶„ì„í•˜ê¸°</button>
                        <button class="secondary-btn analyzer-scan-btn" onclick="openIACamera()">ğŸ“¸ Scan Label</button>
                        <button class="secondary-btn analyzer-scan-btn" onclick="triggerIAUpload()">ğŸ–¼ï¸ Upload Label</button>
                        <button class="secondary-btn analyzer-clear-btn" onclick="clearAnalyzer()">Clear</button>
                        <input type="file" id="ia-file-input" accept="image/*" style="display:none" onchange="handleIAUpload(event)">
                    </div>

                    <!-- Inline Camera / Preview Area (hidden by default) -->
                    <div id="ia-scan-area" class="ia-scan-area hidden">
                        <div class="ia-camera-wrapper">
                            <video id="ia-video" autoplay playsinline></video>
                            <canvas id="ia-canvas" style="display:none"></canvas>
                            <img id="ia-preview" style="display:none" alt="Preview">
                            <div id="ia-scan-guide" class="ia-scan-guide">
                                <div class="ia-scan-frame"></div>
                                <p class="ia-scan-hint">Align ingredient list inside the frame<br>ì„±ë¶„í‘œë¥¼ í”„ë ˆì„ ì•ˆì— ë§ì¶°ì£¼ì„¸ìš”</p>
                            </div>
                        </div>
                        <div id="ia-camera-controls" class="pc-controls">
                            <button class="secondary-btn" onclick="closeIACamera()">Cancel ì·¨ì†Œ</button>
                            <button class="primary-btn" onclick="captureIAPhoto()">ğŸ“¸ Capture ì´¬ì˜</button>
                        </div>
                        <div id="ia-preview-controls" class="pc-controls hidden">
                            <button class="secondary-btn" onclick="retakeIAPhoto()">â†©ï¸ Retake ë‹¤ì‹œ</button>
                            <button class="primary-btn" onclick="scanIngredients()">ğŸ” Scan ìŠ¤ìº”</button>
                        </div>
                        <p id="ia-cam-error" class="fs-error hidden"></p>
                    </div>

                    <!-- Inline scan progress -->
                    <div id="ia-scan-progress" class="ia-scan-progress hidden">
                        <div class="ia-progress-bar"><div id="ia-progress-fill" class="progress-fill" style="width:0%"></div></div>
                        <p id="ia-scan-status" class="ia-scan-status-text">Scanning...</p>
                    </div>

                    <div id="analyzer-results" class="analyzer-results"></div>
                </div>

                <!-- 10-Step Routine Guide -->
                <div class="content-card" onclick="toggleContent(this)">
                    <div class="content-card-header"><div><h3>The Korean 10-Step Skincare Routine</h3><p class="content-subtitle">í•œêµ­ì‹ 10ë‹¨ê³„ ìŠ¤í‚¨ì¼€ì–´ ë£¨í‹´</p></div><span class="content-chevron">&#9660;</span></div>
                    <div class="content-card-body">
                        <p class="content-text">The famous Korean skincare routine focuses on layering lightweight products for maximum hydration and protection. Here is the complete order and what each step does for your skin:</p>
                        <div class="step-list">
                            <div class="step-item"><span class="step-num">1</span><div class="step-info"><strong>Oil Cleanser</strong> <span class="step-kr">ì˜¤ì¼ í´ë Œì €</span><p>Removes makeup, sunscreen, and oil-based impurities. Massage onto dry skin, then rinse with water.</p></div></div>
                            <div class="step-item"><span class="step-num">2</span><div class="step-info"><strong>Water Cleanser</strong> <span class="step-kr">í¼ í´ë Œì €</span><p>Removes remaining water-based impurities like sweat and dirt. This double-cleanse method ensures a perfectly clean base.</p></div></div>
                            <div class="step-item"><span class="step-num">3</span><div class="step-info"><strong>Exfoliator</strong> <span class="step-kr">ê°ì§ˆ ì œê±°ì œ</span><p>Use 1-2 times per week to remove dead skin cells. Choose between physical scrubs or chemical exfoliants (AHA/BHA).</p></div></div>
                            <div class="step-item"><span class="step-num">4</span><div class="step-info"><strong>Toner</strong> <span class="step-kr">í† ë„ˆ</span><p>Balances skin pH and preps skin to absorb the next products better. Pat gently into skin with hands.</p></div></div>
                            <div class="step-item"><span class="step-num">5</span><div class="step-info"><strong>Essence</strong> <span class="step-kr">ì—ì„¼ìŠ¤</span><p>The heart of Korean skincare. A lightweight, hydrating layer that promotes cell turnover and radiance.</p></div></div>
                            <div class="step-item"><span class="step-num">6</span><div class="step-info"><strong>Serum / Ampoule</strong> <span class="step-kr">ì„¸ëŸ¼ / ì•°í”Œ</span><p>Concentrated treatments targeting specific concerns like wrinkles, dark spots, or acne.</p></div></div>
                            <div class="step-item"><span class="step-num">7</span><div class="step-info"><strong>Sheet Mask</strong> <span class="step-kr">ì‹œíŠ¸ ë§ˆìŠ¤í¬</span><p>Use 1-3 times per week for an intense boost of hydration and nutrients. Leave on for 15-20 minutes.</p></div></div>
                            <div class="step-item"><span class="step-num">8</span><div class="step-info"><strong>Eye Cream</strong> <span class="step-kr">ì•„ì´í¬ë¦¼</span><p>Delicate eye area needs special care. Gently pat around the orbital bone to prevent fine lines.</p></div></div>
                            <div class="step-item"><span class="step-num">9</span><div class="step-info"><strong>Moisturizer</strong> <span class="step-kr">ë³´ìŠµì œ</span><p>Seals in all previous layers. Choose gel for oily skin, cream for dry skin, or lotion for combination.</p></div></div>
                            <div class="step-item"><span class="step-num">10</span><div class="step-info"><strong>Sunscreen</strong> <span class="step-kr">ì„ í¬ë¦¼</span><p>The most important step! Apply every morning, rain or shine. Korean sunscreens are known for their lightweight, non-greasy formulas.</p></div></div>
                        </div>
                    </div>
                </div>

                <!-- Skincare Routine Order Guide -->
                <div class="content-card" onclick="toggleContent(this)">
                    <div class="content-card-header"><div><h3>Skincare Layering Guide</h3><p class="content-subtitle">ìŠ¤í‚¨ì¼€ì–´ ë°”ë¥´ëŠ” ìˆœì„œ ê°€ì´ë“œ</p></div><span class="content-chevron">&#9660;</span></div>
                    <div class="content-card-body" onclick="event.stopPropagation()">

                        <p class="content-text">Not sure what order to apply your skincare? The golden rule is simple: apply from the thinnest, most watery texture to the thickest, most oily texture.</p>
                        <p class="content-text" style="color:#888; font-size:0.82rem;">ìŠ¤í‚¨ì¼€ì–´ëŠ” ê°€ì¥ ë¬½ì€ ì œí˜•(ìˆ˜ë¶„)ì—ì„œ ê°€ì¥ ê¾¸ë•í•œ ì œí˜•(ìœ ë¶„) ìˆœì„œë¡œ ë°”ë¥´ëŠ” ê²ƒì´ ê¸°ë³¸ì…ë‹ˆë‹¤.</p>

                        <!-- Key Principle Visual -->
                        <div class="routine-key-principle">
                            <span class="principle-icon">ğŸ’§ âœ ğŸ§´</span>
                            <div class="principle-text">Thin & Watery â†’ Thick & Oily</div>
                            <div class="principle-text-kr">ë¬½ì€ ì œí˜• (ìˆ˜ë¶„) â†’ ê¾¸ë•í•œ ì œí˜• (ìœ ë¶„)</div>
                        </div>

                        <!-- Texture Gradient Bar -->
                        <div class="texture-bar-bg">
                            <div class="texture-bar-labels">
                                <span class="texture-label texture-label-left">ğŸ’§ Water<br>ìˆ˜ë¶„</span>
                                <span class="texture-bar-arrow">â†’ â†’ â†’</span>
                                <span class="texture-label texture-label-right">ğŸ«§ Oil<br>ìœ ë¶„</span>
                            </div>
                        </div>

                        <!-- AM / PM Routine Tabs -->
                        <div class="routine-tab-nav">
                            <button class="routine-tab-btn active" onclick="switchRoutineTab('am', event)">â˜€ï¸ Morning ì•„ì¹¨</button>
                            <button class="routine-tab-btn" onclick="switchRoutineTab('pm', event)">ğŸŒ™ Evening ì €ë…</button>
                        </div>

                        <!-- Morning Routine Panel -->
                        <div id="routine-am" class="routine-tab-panel">
                            <p class="routine-tab-desc">Hydration + protection in 5 simple steps.<br><span style="color:#888;">ìˆ˜ë¶„ ì¶©ì „ê³¼ ìì™¸ì„  ì°¨ë‹¨ ì¤‘ì‹¬ì˜ 5ë‹¨ê³„.</span></p>
                            <div class="routine-flow">
                                <div class="routine-flow-step routine-water">
                                    <span class="routine-flow-icon">ğŸ«§</span>
                                    <div class="routine-flow-info">
                                        <strong>Cleanser</strong> <span class="routine-kr">í´ë Œì €</span>
                                        <p>Gentle water cleanser only. Skip if skin feels dry â€” just splash lukewarm water.</p>
                                    </div>
                                </div>
                                <div class="routine-flow-arrow">â–¼</div>
                                <div class="routine-flow-step routine-water">
                                    <span class="routine-flow-icon">ğŸ’¦</span>
                                    <div class="routine-flow-info">
                                        <strong>Toner</strong> <span class="routine-kr">í† ë„ˆ</span>
                                        <p>Balances pH, preps skin to absorb the next layers better.</p>
                                    </div>
                                    <span class="routine-flow-time">10-20s</span>
                                </div>
                                <div class="routine-flow-arrow">â–¼</div>
                                <div class="routine-flow-step routine-water">
                                    <span class="routine-flow-icon">ğŸ’</span>
                                    <div class="routine-flow-info">
                                        <strong>Serum / Essence</strong> <span class="routine-kr">ì„¸ëŸ¼ / ì—ì„¼ìŠ¤</span>
                                        <p>Vitamin C for brightening, niacinamide for pores, hyaluronic acid for hydration.</p>
                                    </div>
                                    <span class="routine-flow-time">30-60s</span>
                                </div>
                                <div class="routine-flow-arrow">â–¼</div>
                                <div class="routine-flow-step routine-oil">
                                    <span class="routine-flow-icon">ğŸ§´</span>
                                    <div class="routine-flow-info">
                                        <strong>Moisturizer</strong> <span class="routine-kr">ë¡œì…˜ / í¬ë¦¼</span>
                                        <p>Locks in all layers. Gel for oily skin, cream for dry skin.</p>
                                    </div>
                                    <span class="routine-flow-time">1-2min</span>
                                </div>
                                <div class="routine-flow-arrow">â–¼</div>
                                <div class="routine-flow-step routine-sun">
                                    <span class="routine-flow-icon">â˜€ï¸</span>
                                    <div class="routine-flow-info">
                                        <strong>Sunscreen SPF 50+</strong> <span class="routine-kr">ì„ í¬ë¦¼</span>
                                        <p>Always the LAST step. Apply generously. Reapply every 2-3 hours outdoors.</p>
                                    </div>
                                    <span class="routine-flow-time">LAST</span>
                                </div>
                            </div>
                        </div>

                        <!-- Evening Routine Panel -->
                        <div id="routine-pm" class="routine-tab-panel hidden">
                            <p class="routine-tab-desc">Deep cleansing + repair while you sleep.<br><span style="color:#888;">ë”¥ í´ë Œì§•ê³¼ ìˆ˜ë©´ ì¤‘ í”¼ë¶€ ì¬ìƒì„ ìœ„í•œ ë£¨í‹´.</span></p>
                            <div class="routine-flow">
                                <div class="routine-flow-step routine-oil">
                                    <span class="routine-flow-icon">ğŸ«’</span>
                                    <div class="routine-flow-info">
                                        <strong>Oil Cleanser</strong> <span class="routine-kr">ì˜¤ì¼ í´ë Œì €</span>
                                        <p>Dissolves makeup & sunscreen. Massage on dry face, then emulsify with water.</p>
                                    </div>
                                </div>
                                <div class="routine-flow-arrow">â–¼</div>
                                <div class="routine-flow-step routine-water">
                                    <span class="routine-flow-icon">ğŸ«§</span>
                                    <div class="routine-flow-info">
                                        <strong>Water Cleanser</strong> <span class="routine-kr">í¼ í´ë Œì €</span>
                                        <p>Second cleanse to remove remaining impurities. This is the "double cleanse" method.</p>
                                    </div>
                                </div>
                                <div class="routine-flow-arrow">â–¼</div>
                                <div class="routine-flow-step routine-water">
                                    <span class="routine-flow-icon">ğŸ’¦</span>
                                    <div class="routine-flow-info">
                                        <strong>Toner</strong> <span class="routine-kr">í† ë„ˆ</span>
                                        <p>Restore pH after cleansing. Layer 2-3 times for extra hydration (7-skin method).</p>
                                    </div>
                                    <span class="routine-flow-time">10-20s</span>
                                </div>
                                <div class="routine-flow-arrow">â–¼</div>
                                <div class="routine-flow-step routine-water">
                                    <span class="routine-flow-icon">ğŸ’</span>
                                    <div class="routine-flow-info">
                                        <strong>Serum / Ampoule</strong> <span class="routine-kr">ì„¸ëŸ¼ / ì•°í”Œ</span>
                                        <p>Best time for actives: retinol, AHA/BHA, or peptides for anti-aging.</p>
                                    </div>
                                    <span class="routine-flow-time">30-60s</span>
                                </div>
                                <div class="routine-flow-arrow">â–¼</div>
                                <div class="routine-flow-step routine-water">
                                    <span class="routine-flow-icon">ğŸ‘ï¸</span>
                                    <div class="routine-flow-info">
                                        <strong>Eye Cream</strong> <span class="routine-kr">ì•„ì´í¬ë¦¼</span>
                                        <p>Gently pat around orbital bone with ring finger. Never pull or rub.</p>
                                    </div>
                                    <span class="routine-flow-time">30s</span>
                                </div>
                                <div class="routine-flow-arrow">â–¼</div>
                                <div class="routine-flow-step routine-oil">
                                    <span class="routine-flow-icon">ğŸ§´</span>
                                    <div class="routine-flow-info">
                                        <strong>Night Cream</strong> <span class="routine-kr">ë‚˜ì´íŠ¸ í¬ë¦¼</span>
                                        <p>Richer than daytime moisturizer. Seals in everything for overnight repair.</p>
                                    </div>
                                    <span class="routine-flow-time">LAST</span>
                                </div>
                            </div>
                        </div>

                        <!-- Sub-accordions: extra info collapsed by default -->
                        <div class="sub-accordion" onclick="toggleSubAccordion(this)">
                            <div class="sub-accordion-header">
                                <span>â± Wait Times Between Steps ë‹¨ê³„ë³„ í¡ìˆ˜ ì‹œê°„</span>
                                <span class="sub-accordion-icon">+</span>
                            </div>
                            <div class="sub-accordion-body">
                                <div class="step-list">
                                    <div class="step-item"><span class="step-num">â±</span><div class="step-info"><strong>Toner â†’ Serum</strong> <span class="step-kr">í† ë„ˆ â†’ ì„¸ëŸ¼</span><p>10-20s â€” until slightly tacky, not fully dry.</p></div></div>
                                    <div class="step-item"><span class="step-num">â±</span><div class="step-info"><strong>Serum â†’ Moisturizer</strong> <span class="step-kr">ì„¸ëŸ¼ â†’ ë³´ìŠµì œ</span><p>30-60s â€” pat gently to help absorption.</p></div></div>
                                    <div class="step-item"><span class="step-num">â±</span><div class="step-info"><strong>Moisturizer â†’ Sunscreen</strong> <span class="step-kr">ë³´ìŠµì œ â†’ ì„ í¬ë¦¼</span><p>1-2 min â€” so sunscreen doesn't mix and lose UV protection.</p></div></div>
                                    <div class="step-item"><span class="step-num">â±</span><div class="step-info"><strong>Actives (Retinol, AHA/BHA)</strong> <span class="step-kr">í™œì„± ì„±ë¶„</span><p>2-3 min â€” actives need time to penetrate first.</p></div></div>
                                </div>
                            </div>
                        </div>

                        <div class="sub-accordion" onclick="toggleSubAccordion(this)">
                            <div class="sub-accordion-header">
                                <span>ğŸ§¬ Adjust by Skin Type í”¼ë¶€ íƒ€ì…ë³„ í¬ì¸íŠ¸</span>
                                <span class="sub-accordion-icon">+</span>
                            </div>
                            <div class="sub-accordion-body">
                                <div class="skintype-routine-grid">
                                    <div class="skintype-routine-card"><strong>ğŸœï¸ Dry ê±´ì„±</strong><p>Skip cleanser AM â€” lukewarm water only. Toner 2-3x. Cream + face oil at night.</p><p style="color:#888;font-size:0.76rem;margin-top:2px;">ì•„ì¹¨ ì„¸ì•ˆì€ ë¯¸ì˜¨ìˆ˜ë§Œ. í† ë„ˆ 2-3íšŒ. í¬ë¦¼ + ì €ë… ì˜¤ì¼.</p></div>
                                    <div class="skintype-routine-card"><strong>ğŸ’§ Oily ì§€ì„±</strong><p>Gel/water-based only. Still moisturize â€” skipping increases oil. BHA serum PM.</p><p style="color:#888;font-size:0.76rem;margin-top:2px;">ì ¤/ìˆ˜ë¶„ íƒ€ì…. ë³´ìŠµ í•„ìˆ˜. ì €ë… BHA ì„¸ëŸ¼.</p></div>
                                    <div class="skintype-routine-card"><strong>ğŸ”„ Combo ë³µí•©ì„±</strong><p>Light on T-zone, rich on cheeks. Different moisturizers per zone is fine.</p><p style="color:#888;font-size:0.76rem;margin-top:2px;">Tì¡´ ê°€ë³ê²Œ, ë³¼ ë¦¬ì¹˜í•˜ê²Œ.</p></div>
                                    <div class="skintype-routine-card"><strong>ğŸŒ¿ Sensitive ë¯¼ê°ì„±</strong><p>3-4 steps max. No fragrance/alcohol. CICA or ceramide. Patch test always.</p><p style="color:#888;font-size:0.76rem;margin-top:2px;">ìµœì†Œ ë‹¨ê³„. ì‹œì¹´/ì„¸ë¼ë§ˆì´ë“œ. íŒ¨ì¹˜ í…ŒìŠ¤íŠ¸ í•„ìˆ˜.</p></div>
                                </div>
                            </div>
                        </div>

                        <div class="sub-accordion" onclick="toggleSubAccordion(this)">
                            <div class="sub-accordion-header">
                                <span>âš ï¸ Common Mistakes í”í•œ ì‹¤ìˆ˜</span>
                                <span class="sub-accordion-icon">+</span>
                            </div>
                            <div class="sub-accordion-body">
                                <div class="mistake-list">
                                    <div class="mistake-item"><span class="mistake-icon">âŒ</span><div><strong>Oily before watery ìœ ë¶„ ë¨¼ì €</strong><p>Oil blocks water absorption. Always thin â†’ thick.</p></div></div>
                                    <div class="mistake-item"><span class="mistake-icon">âŒ</span><div><strong>Skipping sunscreen ì„ í¬ë¦¼ ë¹¼ë¨¹ê¸°</strong><p>#1 cause of aging & dark spots. Even on cloudy days.</p></div></div>
                                    <div class="mistake-item"><span class="mistake-icon">âŒ</span><div><strong>Too many at once í•œêº¼ë²ˆì— ë„ˆë¬´ ë§ì´</strong><p>Start with 3-4 products. Build up slowly.</p></div></div>
                                    <div class="mistake-item"><span class="mistake-icon">âŒ</span><div><strong>No wait time í¡ìˆ˜ ì‹œê°„ ì—†ì´</strong><p>Causes pilling and reduced absorption.</p></div></div>
                                    <div class="mistake-item"><span class="mistake-icon">âŒ</span><div><strong>Bad combos ìƒê·¹ ì„±ë¶„ í˜¼í•©</strong><p>Vitamin C + AHA/BHA or retinol + AHA/BHA â€” alternate AM/PM.</p></div></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- Key Ingredients Guide -->
                <div class="content-card" onclick="toggleContent(this)">
                    <div class="content-card-header"><div><h3>Popular K-Beauty Ingredients</h3><p class="content-subtitle">ì¸ê¸° K-ë·°í‹° ì„±ë¶„ ê°€ì´ë“œ</p></div><span class="content-chevron">&#9660;</span></div>
                    <div class="content-card-body">
                        <p class="content-text">Understanding ingredients helps you choose the right products for your skin. Here are the most popular ingredients found in Korean skincare and what they do:</p>
                        <div class="ingredient-grid">
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸŒ</div><div><strong>Snail Mucin</strong><p>Hydrates, repairs damaged skin, fades scars. Found in COSRX Snail Mucin Essence.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸŒ¿</div><div><strong>Centella Asiatica (CICA)</strong><p>Calms inflammation, strengthens skin barrier. Best for sensitive and acne-prone skin.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸ’§</div><div><strong>Hyaluronic Acid</strong><p>Holds 1000x its weight in water. Plumps skin and reduces fine lines instantly.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸš</div><div><strong>Rice Extract</strong><p>Traditional Korean ingredient for brightening. Evens skin tone and adds natural glow.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸ«–</div><div><strong>Green Tea</strong><p>Rich in antioxidants, controls oil production, and soothes irritated skin.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸ§´</div><div><strong>Niacinamide (Vitamin B3)</strong><p>Minimizes pores, controls oil, brightens dark spots. Works for all skin types.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸŒ™</div><div><strong>Retinol</strong><p>Gold standard for anti-aging. Boosts collagen, reduces wrinkles. Start with low concentrations.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸ§ª</div><div><strong>BHA (Salicylic Acid)</strong><p>Oil-soluble acid that penetrates pores. Best for blackheads, acne, and oily skin.</p></div></div>
                        </div>
                    </div>
                </div>

                <!-- Beginner Tips -->
                <div class="content-card" onclick="toggleContent(this)">
                    <div class="content-card-header"><div><h3>K-Beauty Beginner Tips</h3><p class="content-subtitle">K-ë·°í‹° ì´ˆë³´ì íŒ</p></div><span class="content-chevron">&#9660;</span></div>
                    <div class="content-card-body">
                        <div class="tip-list">
                            <div class="tip-item"><strong>Start simple.</strong> You do not need all 10 steps. Begin with cleanser, moisturizer, and sunscreen, then add one product at a time.</div>
                            <div class="tip-item"><strong>Patch test everything.</strong> Apply new products on a small area of your jaw or behind your ear for 24 hours before full application.</div>
                            <div class="tip-item"><strong>Give products time.</strong> Most skincare needs 4-6 weeks to show results. Do not switch products every few days.</div>
                            <div class="tip-item"><strong>SPF is non-negotiable.</strong> Korean sunscreens are lightweight and cosmetically elegant. Apply generously every morning.</div>
                            <div class="tip-item"><strong>Hydration over everything.</strong> Korean skincare philosophy prioritizes keeping skin hydrated as the foundation of all skin health.</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Procedures/Clinics Tab -->
            <section id="procedures" class="tab-panel hidden">
                <h2 class="section-title">K-Beauty Clinics</h2>
                <p class="section-subtitle">í•œêµ­ í”¼ë¶€ê³¼ & ì‹œìˆ  ì •ë³´</p>

                <!-- Sub Tab Navigation -->
                <div class="sub-tab-nav">
                    <button class="sub-tab-btn active" data-subtab="procedures-info" onclick="switchSubTab('procedures-info', event)">ğŸ’‰ Procedures ì‹œìˆ </button>
                    <button class="sub-tab-btn" data-subtab="clinic-finder" onclick="switchSubTab('clinic-finder', event)">ğŸ¥ Find Clinic ë³‘ì›ì°¾ê¸°</button>
                </div>

                <!-- Sub Tab: Procedures -->
                <div id="procedures-info" class="sub-tab-panel">
                    <div class="procedures-grid" id="procedures-grid"></div>
                </div>

                <!-- Sub Tab: Clinic Finder -->
                <div id="clinic-finder" class="sub-tab-panel hidden">
                    <div class="clinic-filter">
                        <button class="filter-btn active" onclick="filterClinics('all', event)">All ì „ì²´</button>
                        <button class="filter-btn" onclick="filterClinics('botox', event)">Botox</button>
                        <button class="filter-btn" onclick="filterClinics('laser', event)">Laser</button>
                        <button class="filter-btn" onclick="filterClinics('filler', event)">Filler</button>
                        <button class="filter-btn" onclick="filterClinics('lifting', event)">Lifting</button>
                        <button class="filter-btn" onclick="filterClinics('pico', event)">Pico</button>
                        <button class="filter-btn" onclick="filterClinics('skinbooster', event)">Skin Booster</button>
                        <button class="filter-btn" onclick="filterClinics('thread', event)">Thread</button>
                        <button class="filter-btn" onclick="filterClinics('aquapeel', event)">Aqua Peel</button>
                    </div>
                    <div class="clinics-grid" id="clinics-grid"></div>
                </div>
            </section>

            <!-- AI Beauty Tab -->
            <section id="ai" class="tab-panel hidden">
                <h2 class="section-title">AI Beauty Analysis</h2>
                <p class="section-subtitle">AI ë·°í‹° ë¶„ì„</p>

                <!-- Face Shape Detector -->
                <div id="fs-section">
                    <!-- Screen 1: Start -->
                    <div id="fs-start" class="fs-screen">
                        <div class="pc-start-card">
                            <div class="quiz-icon">ğŸ“</div>
                            <h2>AI Face Shape Detector</h2>
                            <h3>AI ì–¼êµ´í˜• ë¶„ì„</h3>
                            <p>Take a photo or upload an image to discover your face shape and get personalized styling tips!</p>
                            <p class="korean">ì‚¬ì§„ì„ ì´¬ì˜í•˜ê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì—¬ ì–¼êµ´í˜•ì„ ë¶„ì„í•˜ê³  ë§ì¶¤ ìŠ¤íƒ€ì¼ë§ íŒì„ ë°›ì•„ë³´ì„¸ìš”!</p>
                            <div class="fs-btn-group">
                                <button class="primary-btn" onclick="startFaceCamera()">ğŸ“¸ Take Photo ì´¬ì˜</button>
                                <button class="secondary-btn" onclick="triggerFaceUpload()">ğŸ–¼ï¸ Upload Image ì—…ë¡œë“œ</button>
                                <input type="file" id="fs-file-input" accept="image/*" style="display:none" onchange="handleFaceUpload(event)">
                            </div>
                        </div>
                    </div>

                    <!-- Screen 2: Camera / Preview -->
                    <div id="fs-camera" class="fs-screen hidden">
                        <div class="fs-camera-card">
                            <div class="fs-camera-wrapper">
                                <video id="fs-video" autoplay playsinline></video>
                                <canvas id="fs-canvas" style="display:none"></canvas>
                                <img id="fs-preview" style="display:none" alt="Preview">
                                <div id="fs-face-guide" class="fs-face-guide">
                                    <div class="fs-face-oval"></div>
                                </div>
                            </div>
                            <div id="fs-camera-controls" class="fs-controls">
                                <button class="secondary-btn" onclick="cancelFaceDetection()">â† Back ë’¤ë¡œ</button>
                                <button class="primary-btn" id="fs-capture-btn" onclick="captureFacePhoto()">ğŸ“¸ Capture ì´¬ì˜</button>
                            </div>
                            <div id="fs-preview-controls" class="fs-controls hidden">
                                <button class="secondary-btn" onclick="retakeFacePhoto()">â†©ï¸ Retake ë‹¤ì‹œ</button>
                                <button class="primary-btn" onclick="analyzeFaceShape()">ğŸ” Analyze ë¶„ì„</button>
                            </div>
                            <div id="fs-loading" class="fs-loading hidden">
                                <div class="fs-spinner"></div>
                                <p>Analyzing your face shape... ì–¼êµ´í˜• ë¶„ì„ ì¤‘...</p>
                            </div>
                            <p id="fs-error" class="fs-error hidden"></p>
                        </div>
                    </div>

                    <!-- Screen 3: Result -->
                    <div id="fs-result" class="fs-screen hidden">
                        <div id="fs-result-content" class="result-card"></div>
                    </div>
                </div>

                <!-- Personal Color Test â€” AI Color Draping -->
                <div id="pc-section">
                    <!-- Screen 1: Start -->
                    <div id="pc-start" class="pc-screen">
                        <div class="pc-start-card">
                            <div class="quiz-icon">ğŸ¨</div>
                            <h2>AI Color Draping</h2>
                            <h3>AI ì»¬ëŸ¬ ë“œë ˆì´í•‘ ì§„ë‹¨</h3>
                            <p>Take a selfie and compare colors side-by-side â€” just like a real draping session! 5 quick rounds to find your season.</p>
                            <p class="korean">ì…€ì¹´ë¥¼ ì°ê³  ì‹¤ì œ ë“œë ˆì´í•‘ì²˜ëŸ¼ ìƒ‰ìƒì„ ë¹„êµí•´ë³´ì„¸ìš”! 5ë¼ìš´ë“œë¡œ í¼ìŠ¤ë„ì»¬ëŸ¬ë¥¼ ì°¾ì•„ë“œë ¤ìš”.</p>
                            <div class="pc-btn-group">
                                <button class="primary-btn" onclick="startPCCamera()">ğŸ“¸ Take Photo ì´¬ì˜</button>
                                <button class="secondary-btn" onclick="triggerPCUpload()">ğŸ–¼ï¸ Upload Image ì—…ë¡œë“œ</button>
                                <input type="file" id="pc-file-input" accept="image/*" style="display:none" onchange="handlePCUpload(event)">
                            </div>
                        </div>
                    </div>

                    <!-- Screen 2: Camera / Preview -->
                    <div id="pc-camera" class="pc-screen hidden">
                        <div class="pc-camera-card">
                            <div class="pc-camera-wrapper">
                                <video id="pc-video" autoplay playsinline></video>
                                <canvas id="pc-canvas" style="display:none"></canvas>
                                <img id="pc-preview" style="display:none" alt="Preview">
                                <div id="pc-face-guide" class="fs-face-guide">
                                    <div class="fs-face-oval"></div>
                                </div>
                            </div>
                            <div id="pc-camera-controls" class="pc-controls">
                                <button class="secondary-btn" onclick="cancelPCCamera()">â† Back ë’¤ë¡œ</button>
                                <button class="primary-btn" id="pc-capture-btn" onclick="capturePCPhoto()">ğŸ“¸ Capture ì´¬ì˜</button>
                            </div>
                            <div id="pc-preview-controls" class="pc-controls hidden">
                                <button class="secondary-btn" onclick="retakePCPhoto()">â†©ï¸ Retake ë‹¤ì‹œ</button>
                                <button class="primary-btn" onclick="startDraping()">ğŸ¨ Start Draping ë“œë ˆì´í•‘ ì‹œì‘</button>
                            </div>
                            <p id="pc-cam-error" class="fs-error hidden"></p>
                        </div>
                    </div>

                    <!-- Screen 3: Draping Comparison -->
                    <div id="pc-draping" class="pc-screen hidden">
                        <div class="draping-card">
                            <div class="draping-header">
                                <div class="draping-round-label" id="draping-round-label">Round 1 / 5</div>
                                <div class="progress-bar"><div id="draping-progress-fill" class="progress-fill" style="width:20%"></div></div>
                                <p class="draping-instruction">Which color makes the face look brighter?<br><span class="korean">ì–´ëŠ ìª½ì´ ë” í™”ì‚¬í•´ ë³´ì´ë‚˜ìš”?</span></p>
                            </div>
                            <div class="draping-comparison" id="draping-comparison"></div>
                        </div>
                    </div>

                    <!-- Screen 4: Analyzing -->
                    <div id="pc-analyzing" class="pc-screen hidden">
                        <div class="pc-analyzing-card">
                            <div class="pc-analyzing-spinner"></div>
                            <h3>Analyzing your colors...</h3>
                            <p class="korean">ì»¬ëŸ¬ë¥¼ ë¶„ì„í•˜ê³  ìˆì–´ìš”...</p>
                        </div>
                    </div>

                    <!-- Screen 5: Result -->
                    <div id="pc-result" class="pc-screen hidden">
                        <div id="pc-result-content" class="result-card"></div>
                    </div>
                </div>

                <!-- Popular Procedures Explained -->
                <div class="content-card" onclick="toggleContent(this)">
                    <div class="content-card-header"><div><h3>Understanding K-Beauty Procedures</h3><p class="content-subtitle">K-ë·°í‹° ì‹œìˆ  ì´í•´í•˜ê¸°</p></div><span class="content-chevron">&#9660;</span></div>
                    <div class="content-card-body">
                        <p class="content-text">Korea is the global capital of aesthetic procedures. Here is what first-timers should know before visiting a clinic:</p>
                        <div class="tip-list">
                            <div class="tip-item"><strong>Consultation is always first.</strong> Every reputable clinic provides a free consultation. The doctor examines your skin and recommends the right treatment.</div>
                            <div class="tip-item"><strong>Non-surgical is mainstream.</strong> Most popular treatments like Botox, fillers, and laser toning are non-surgical with little to no downtime.</div>
                            <div class="tip-item"><strong>Prices are competitive.</strong> Korean clinics offer world-class treatments at a fraction of Western prices, which is why medical tourism is booming.</div>
                            <div class="tip-item"><strong>Maintenance matters.</strong> Botox lasts 3-6 months, fillers 6-18 months, and laser results are cumulative. Plan for follow-up visits.</div>
                            <div class="tip-item"><strong>Ask about English support.</strong> Many Gangnam clinics have English-speaking staff or translators. Check our Clinics tab for English-friendly options.</div>
                        </div>
                    </div>
                </div>

            </section>

            <!-- Wellness Tab -->
            <section id="wellness" class="tab-panel hidden">
                <h2 class="section-title">Wellness & Lifestyle</h2>
                <p class="section-subtitle">ì›°ë‹ˆìŠ¤ & ë¼ì´í”„ìŠ¤íƒ€ì¼</p>

                <!-- Skin-Food Guide -->
                <div class="content-card" onclick="toggleContent(this)">
                    <div class="content-card-header"><div><h3>Skin-Food Connection</h3><p class="content-subtitle">í”¼ë¶€ì™€ ìŒì‹ì˜ ê´€ê³„</p></div><span class="content-chevron">&#9660;</span></div>
                    <div class="content-card-body">
                        <p class="content-text">What you eat directly affects your skin. Korean beauty philosophy emphasizes inner health as the foundation of outer beauty. Here are the best and worst foods for common skin concerns:</p>
                        <div class="food-guide">
                            <div class="food-section">
                                <h4>For Acne-Prone Skin ì—¬ë“œë¦„ í”¼ë¶€</h4>
                                <p class="food-good">Eat: Fatty fish (salmon, mackerel), green vegetables, berries, green tea, probiotics (kimchi, yogurt)</p>
                                <p class="food-bad">Avoid: Dairy products, refined sugar, white bread, greasy fried foods, alcohol</p>
                            </div>
                            <div class="food-section">
                                <h4>For Dry Skin ê±´ì„± í”¼ë¶€</h4>
                                <p class="food-good">Eat: Avocado, nuts and seeds, olive oil, sweet potato, water-rich fruits (watermelon, cucumber)</p>
                                <p class="food-bad">Avoid: Excessive caffeine, salty snacks, alcohol, processed foods</p>
                            </div>
                            <div class="food-section">
                                <h4>For Anti-Aging ë…¸í™” ë°©ì§€</h4>
                                <p class="food-good">Eat: Blueberries, dark chocolate, tomatoes, spinach, bone broth, collagen-rich foods</p>
                                <p class="food-bad">Avoid: Excessive sugar, charred or heavily processed meats, trans fats</p>
                            </div>
                            <div class="food-section">
                                <h4>For Brightening í”¼ë¶€ ë¯¸ë°±</h4>
                                <p class="food-good">Eat: Citrus fruits (vitamin C), papaya, bell peppers, turmeric, tomatoes (lycopene)</p>
                                <p class="food-bad">Avoid: Excessive alcohol, refined carbs, high-sodium foods</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Korean Superfoods -->
                <div class="content-card" onclick="toggleContent(this)">
                    <div class="content-card-header"><div><h3>Korean Superfoods for Skin</h3><p class="content-subtitle">í”¼ë¶€ë¥¼ ìœ„í•œ í•œêµ­ ìŠˆí¼í‘¸ë“œ</p></div><span class="content-chevron">&#9660;</span></div>
                    <div class="content-card-body">
                        <p class="content-text">Korean cuisine is packed with skin-friendly ingredients that have been used for centuries. Incorporate these traditional foods into your diet for glowing skin:</p>
                        <div class="ingredient-grid">
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸ¥¬</div><div><strong>Kimchi ê¹€ì¹˜</strong><p>Rich in probiotics and vitamins A, B, and C. Supports gut health, which directly improves skin clarity.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸ«˜</div><div><strong>Soybean Paste ëœì¥</strong><p>Fermented soybeans contain isoflavones that boost collagen production and have antioxidant properties.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸš</div><div><strong>Rice Water ìŒ€ëœ¨ë¬¼</strong><p>Used both as a drink and skin rinse. Contains vitamins B and E, minerals that brighten and soften skin.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸµ</div><div><strong>Barley Tea ë³´ë¦¬ì°¨</strong><p>Caffeine-free hydration packed with antioxidants. Koreans drink this daily as a water substitute.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸ¥’</div><div><strong>Seaweed ë¯¸ì—­</strong><p>Packed with omega-3, vitamins, and minerals. Seaweed soup is a Korean staple known for skin regeneration.</p></div></div>
                            <div class="ingredient-item"><div class="ingredient-icon">ğŸ¯</div><div><strong>Honey ê¿€</strong><p>Natural humectant with antibacterial properties. Korean traditional medicine uses it for wound healing and skin hydration.</p></div></div>
                        </div>
                    </div>
                </div>

                <!-- Sleep & Skin -->
                <div class="content-card" onclick="toggleContent(this)">
                    <div class="content-card-header"><div><h3>Sleep, Stress & Skin</h3><p class="content-subtitle">ìˆ˜ë©´, ìŠ¤íŠ¸ë ˆìŠ¤ & í”¼ë¶€</p></div><span class="content-chevron">&#9660;</span></div>
                    <div class="content-card-body">
                        <p class="content-text">Your skin repairs and regenerates while you sleep. Poor sleep and chronic stress are among the biggest hidden causes of skin problems. Here is what the science says:</p>
                        <div class="tip-list">
                            <div class="tip-item"><strong>7-9 hours of sleep is essential.</strong> During deep sleep, your body increases blood flow to the skin, rebuilds collagen, and repairs UV damage. Less than 6 hours leads to dull skin, dark circles, and faster aging.</div>
                            <div class="tip-item"><strong>Stress triggers cortisol.</strong> High cortisol levels increase oil production, leading to breakouts. It also breaks down collagen, causing premature wrinkles and saggy skin.</div>
                            <div class="tip-item"><strong>Night skincare is crucial.</strong> Apply your heaviest treatments (retinol, sleeping masks, rich creams) at night when skin absorption is highest and there is no UV exposure.</div>
                            <div class="tip-item"><strong>Sleep position matters.</strong> Sleeping face-down presses your skin against the pillow, causing wrinkles over time. Try sleeping on your back or use a silk pillowcase.</div>
                            <div class="tip-item"><strong>Manage stress holistically.</strong> Korean wellness culture emphasizes balance: jjimjilbang (Korean sauna), forest bathing, tea ceremonies, and regular skincare routines all reduce stress while benefiting skin.</div>
                        </div>
                    </div>
                </div>

                <!-- Daily Habits -->
                <div class="content-card" onclick="toggleContent(this)">
                    <div class="content-card-header"><div><h3>Daily Habits for Better Skin</h3><p class="content-subtitle">ì¢‹ì€ í”¼ë¶€ë¥¼ ìœ„í•œ ì¼ìƒ ìŠµê´€</p></div><span class="content-chevron">&#9660;</span></div>
                    <div class="content-card-body">
                        <div class="tip-list">
                            <div class="tip-item"><strong>Drink 2L of water daily.</strong> Hydration starts from within. Korean celebrities credit their glass skin to drinking plenty of water throughout the day.</div>
                            <div class="tip-item"><strong>Never skip sunscreen.</strong> UV damage is the number one cause of premature aging. Apply SPF 50+ every morning, even on cloudy days and indoors near windows.</div>
                            <div class="tip-item"><strong>Do not touch your face.</strong> Your hands carry bacteria that can cause breakouts. Avoid resting your chin on your hands or picking at blemishes.</div>
                            <div class="tip-item"><strong>Change your pillowcase weekly.</strong> Oil, bacteria, and dead skin cells accumulate on pillowcases. Switch to silk or satin for less friction on your skin.</div>
                            <div class="tip-item"><strong>Exercise regularly.</strong> Physical activity increases blood circulation, delivering oxygen and nutrients to skin cells. Even a 30-minute walk improves skin health.</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Made with ğŸ’– by Glowmi</p>
            <div class="footer-links">
                <a href="#" onclick="openPage('about'); return false;">About</a>
                <a href="#" onclick="openPage('contact'); return false;">Contact</a>
                <a href="#" onclick="openPage('privacy'); return false;">Privacy Policy</a>
            </div>
            <p class="footer-copy">&copy; 2026 Glowmi. All rights reserved.</p>
        </footer>
    </div>

    <!-- Page Modals -->
    <div id="page-modal" class="page-modal hidden">
        <div class="page-modal-content">
            <button class="page-modal-close" onclick="closePage()">&times;</button>
            <div id="page-modal-body"></div>
        </div>
    </div>

    <script>
// Quiz Data - Summer Version
var summerQuizQuestions = [
    {
        english: "How does your skin feel during hot summer days?",
        korean: "ë”ìš´ ì—¬ë¦„ë‚  í”¼ë¶€ê°€ ì–´ë–»ê²Œ ëŠê»´ì§€ë‚˜ìš”?",
        options: [
            { english: "Dry and tight despite the heat", korean: "ë”ìœ„ì—ë„ ê±´ì¡°í•˜ê³  ë‹¹ê¹€", scores: { dry: 2, oily: 0, combination: 0, sensitive: 1, normal: 0 } },
            { english: "Comfortable, stays balanced", korean: "í¸ì•ˆí•˜ê³  ê· í˜• ì¡íŒ ìƒíƒœ ìœ ì§€", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Extremely oily and shiny", korean: "ë§¤ìš° ê¸°ë¦„ì§€ê³  ë²ˆë“¤ê±°ë¦¼", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "T-zone gets very oily, cheeks normal", korean: "Tì¡´ì€ ë§¤ìš° ê¸°ë¦„ì§€ê³ , ë³¼ì€ ê´œì°®ìŒ", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Red and irritated from heat/sweat", korean: "ì—´ê³¼ ë•€ìœ¼ë¡œ ë¶‰ì–´ì§€ê³  ìê·¹ë°›ìŒ", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "How does your skin react to sunscreen in summer?",
        korean: "ì—¬ë¦„ì— ì„ í¬ë¦¼ ë°”ë¥´ë©´ í”¼ë¶€ ë°˜ì‘ì€?",
        options: [
            { english: "Absorbs quickly, still feels dry", korean: "ë¹ ë¥´ê²Œ í¡ìˆ˜ë˜ê³ , ì—¬ì „íˆ ê±´ì¡°í•¨", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Sits well, no issues", korean: "ì˜ ë§ê³ , ë¬¸ì œ ì—†ìŒ", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Makes skin feel greasy and heavy", korean: "ê¸°ë¦„ì§€ê³  ë¬´ê²ê²Œ ëŠê»´ì§", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Gets oily on forehead, ok elsewhere", korean: "ì´ë§ˆëŠ” ê¸°ë¦„ì ¸ì§€ê³ , ë‹¤ë¥¸ ê³³ì€ ê´œì°®ìŒ", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Causes breakouts or irritation", korean: "íŠ¸ëŸ¬ë¸”ì´ë‚˜ ìê·¹ì„ ìœ ë°œí•¨", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "How often do you need to blot oil in summer?",
        korean: "ì—¬ë¦„ì— ê¸°ë¦„ì¢…ì´ë¥¼ ì–¼ë§ˆë‚˜ ìì£¼ ì‚¬ìš©í•˜ë‚˜ìš”?",
        options: [
            { english: "Never, my skin is never oily", korean: "ì „í˜€ ì•ˆ ì”€, ê¸°ë¦„ì§„ ì  ì—†ìŒ", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Rarely, once a day at most", korean: "ê±°ì˜ ì•ˆ ì”€, í•˜ë£¨ì— í•œ ë²ˆ ì •ë„", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Multiple times throughout the day", korean: "í•˜ë£¨ ì¢…ì¼ ì—¬ëŸ¬ ë²ˆ", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Just for T-zone areas", korean: "Tì¡´ ë¶€ìœ„ë§Œ", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Avoid touching my face due to sensitivity", korean: "ë¯¼ê°í•´ì„œ ì–¼êµ´ ë§Œì§€ëŠ” ê±¸ í”¼í•¨", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "How does humidity affect your skin?",
        korean: "ìŠµë„ê°€ í”¼ë¶€ì— ì–´ë–¤ ì˜í–¥ì„ ì£¼ë‚˜ìš”?",
        options: [
            { english: "Still feels dehydrated", korean: "ì—¬ì „íˆ ìˆ˜ë¶„ ë¶€ì¡± ëŠë‚Œ", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Feels great, skin looks healthy", korean: "ì¢‹ì€ ëŠë‚Œ, í”¼ë¶€ê°€ ê±´ê°•í•´ ë³´ì„", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Gets even more oily and sticky", korean: "ë” ê¸°ë¦„ì§€ê³  ëˆì í•´ì§", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "T-zone suffers, cheeks feel nice", korean: "Tì¡´ì€ í˜ë“¤ê³ , ë³¼ì€ ì¢‹ìŒ", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Can trigger redness or rashes", korean: "í™ì¡°ë‚˜ ë°œì§„ ìœ ë°œ ê°€ëŠ¥", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "What happens when you sweat in summer?",
        korean: "ì—¬ë¦„ì— ë•€ í˜ë¦¬ë©´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?",
        options: [
            { english: "Skin still feels dry after sweating", korean: "ë•€ í˜ë ¤ë„ í”¼ë¶€ëŠ” ì—¬ì „íˆ ê±´ì¡°", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Normal, washes off easily", korean: "ë³´í†µ, ì‰½ê²Œ ì”»ê²¨ë‚˜ê°", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Sweat mixes with oil, causes breakouts", korean: "ë•€ì´ ìœ ë¶„ê³¼ ì„ì—¬ íŠ¸ëŸ¬ë¸” ìœ ë°œ", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Breakouts mainly on forehead/nose", korean: "ì£¼ë¡œ ì´ë§ˆ/ì½”ì— íŠ¸ëŸ¬ë¸”", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Causes stinging or prickly heat", korean: "ë”°ë”ê±°ë¦¬ê±°ë‚˜ ë•€ë  ìœ ë°œ", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "What is your biggest summer skin concern?",
        korean: "ì—¬ë¦„ì²  ê°€ì¥ í° í”¼ë¶€ ê³ ë¯¼ì€?",
        options: [
            { english: "Dehydration and flakiness", korean: "ìˆ˜ë¶„ ë¶€ì¡±ê³¼ ê°ì§ˆ", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Maintaining current good condition", korean: "í˜„ì¬ ì¢‹ì€ ìƒíƒœ ìœ ì§€í•˜ê¸°", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Excess shine and enlarged pores", korean: "ê³¼ë„í•œ ë²ˆë“¤ê±°ë¦¼ê³¼ ë„“ì€ ëª¨ê³µ", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Balancing oily and dry areas", korean: "ì§€ì„±/ê±´ì„± ë¶€ìœ„ ë°¸ëŸ°ìŠ¤", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Sun sensitivity and redness", korean: "í–‡ë¹› ë¯¼ê°ì„±ê³¼ í™ì¡°", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "How does your skin look by end of summer day?",
        korean: "ì—¬ë¦„ í•˜ë£¨ê°€ ëë‚  ë•Œ í”¼ë¶€ ìƒíƒœëŠ”?",
        options: [
            { english: "Tight, dull, needs moisture", korean: "ë‹¹ê¸°ê³ , ì¹™ì¹™í•˜ê³ , ìˆ˜ë¶„ í•„ìš”", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Pretty much the same as morning", korean: "ì•„ì¹¨ê³¼ ê±°ì˜ ê°™ìŒ", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Very shiny, can see oil on face", korean: "ë§¤ìš° ë²ˆë“¤ê±°ë¦¬ê³ , ê¸°ë¦„ì´ ë³´ì„", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Shiny T-zone, normal cheeks", korean: "Tì¡´ì€ ë²ˆë“¤, ë³¼ì€ ë³´í†µ", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Flushed and uncomfortable", korean: "ìƒê¸°ë˜ê³  ë¶ˆí¸í•¨", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    }
];

// Quiz Data - Winter Version
var winterQuizQuestions = [
    {
        english: "How does your skin feel during cold winter days?",
        korean: "ì¶”ìš´ ê²¨ìš¸ë‚  í”¼ë¶€ê°€ ì–´ë–»ê²Œ ëŠê»´ì§€ë‚˜ìš”?",
        options: [
            { english: "Extremely dry, flaky, and tight", korean: "ê·¹ë„ë¡œ ê±´ì¡°í•˜ê³ , ê°ì§ˆì´ ì¼ì–´ë‚˜ê³ , ë‹¹ê¹€", scores: { dry: 2, oily: 0, combination: 0, sensitive: 1, normal: 0 } },
            { english: "Slightly drier but manageable", korean: "ì•½ê°„ ê±´ì¡°í•˜ì§€ë§Œ ê´€ë¦¬ ê°€ëŠ¥", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Still oily, especially by afternoon", korean: "ì—¬ì „íˆ ê¸°ë¦„ì§€ê³ , íŠ¹íˆ ì˜¤í›„ì—", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Cheeks get dry, T-zone stays oily", korean: "ë³¼ì€ ê±´ì¡°í•˜ê³ , Tì¡´ì€ ì—¬ì „íˆ ê¸°ë¦„ì§", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Red, irritated, and reactive", korean: "ë¶‰ê³ , ìê·¹ë°›ê³ , ë¯¼ê°í•´ì§", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "How does indoor heating affect your skin?",
        korean: "ì‹¤ë‚´ ë‚œë°©ì´ í”¼ë¶€ì— ì–´ë–¤ ì˜í–¥ì„ ì£¼ë‚˜ìš”?",
        options: [
            { english: "Makes skin feel parched and cracked", korean: "í”¼ë¶€ê°€ ë°”ì‹¹ ë§ˆë¥´ê³  ê°ˆë¼ì§€ëŠ” ëŠë‚Œ", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Slight tightness, nothing major", korean: "ì•½ê°„ ë‹¹ê¸°ì§€ë§Œ, ì‹¬í•˜ì§„ ì•ŠìŒ", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Does not dry me out much", korean: "ë³„ë¡œ ê±´ì¡°í•´ì§€ì§€ ì•ŠìŒ", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Cheeks feel tight, nose stays oily", korean: "ë³¼ì€ ë‹¹ê¸°ê³ , ì½”ëŠ” ì—¬ì „íˆ ê¸°ë¦„ì§", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Triggers redness and discomfort", korean: "í™ì¡°ì™€ ë¶ˆí¸í•¨ ìœ ë°œ", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "How many layers of moisturizer do you need in winter?",
        korean: "ê²¨ìš¸ì— ë³´ìŠµì œë¥¼ ëª‡ ê²¹ ë°”ë¥´ì‹œë‚˜ìš”?",
        options: [
            { english: "Multiple layers plus facial oil", korean: "ì—¬ëŸ¬ ê²¹ + í˜ì´ì…œ ì˜¤ì¼ê¹Œì§€", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "One good cream is enough", korean: "ì¢‹ì€ í¬ë¦¼ í•˜ë‚˜ë©´ ì¶©ë¶„", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Light moisturizer only, heavy feels greasy", korean: "ê°€ë²¼ìš´ ê²ƒë§Œ, ë¬´ê±°ìš°ë©´ ê¸°ë¦„ì ¸ì§", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Heavy on cheeks, light on T-zone", korean: "ë³¼ì—” ë¬´ê²ê²Œ, Tì¡´ì—” ê°€ë³ê²Œ", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Gentle, fragrance-free products only", korean: "ìˆœí•˜ê³  ë¬´í–¥ ì œí’ˆë§Œ", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "How does cold wind affect your skin?",
        korean: "ì°¨ê°€ìš´ ë°”ëŒì´ í”¼ë¶€ì— ì–´ë–¤ ì˜í–¥ì„ ì£¼ë‚˜ìš”?",
        options: [
            { english: "Causes painful dryness and chapping", korean: "ê³ í†µìŠ¤ëŸ¬ìš´ ê±´ì¡°í•¨ê³¼ ê°ˆë¼ì§ ìœ ë°œ", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Minor discomfort, bounces back quickly", korean: "ì•½ê°„ ë¶ˆí¸í•˜ì§€ë§Œ, ê¸ˆë°© íšŒë³µë¨", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Not much effect, still produces oil", korean: "í° ì˜í–¥ ì—†ìŒ, ì—¬ì „íˆ ìœ ë¶„ ë¶„ë¹„", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Cheeks suffer, T-zone is fine", korean: "ë³¼ì€ í˜ë“¤ê³ , Tì¡´ì€ ê´œì°®ìŒ", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Triggers windburn and redness", korean: "ìœˆë“œë²ˆê³¼ í™ì¡° ìœ ë°œ", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "What happens to your pores in winter?",
        korean: "ê²¨ìš¸ì— ëª¨ê³µì€ ì–´ë–»ê²Œ ë³€í•˜ë‚˜ìš”?",
        options: [
            { english: "Almost invisible, skin looks flat", korean: "ê±°ì˜ ë³´ì´ì§€ ì•Šê³ , í”¼ë¶€ê°€ í‰í‰í•´ ë³´ì„", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Stay the same size year-round", korean: "ì¼ ë…„ ë‚´ë‚´ ê°™ì€ í¬ê¸° ìœ ì§€", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Still visible and can get clogged", korean: "ì—¬ì „íˆ ë³´ì´ê³  ë§‰í ìˆ˜ ìˆìŒ", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Smaller on cheeks, larger on nose", korean: "ë³¼ì€ ì‘ì•„ì§€ê³ , ì½”ëŠ” í¬ê²Œ ìœ ì§€", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Skin texture becomes uneven", korean: "í”¼ë¶€ê²°ì´ ê³ ë¥´ì§€ ì•Šê²Œ ë¨", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "What is your biggest winter skin concern?",
        korean: "ê²¨ìš¸ì²  ê°€ì¥ í° í”¼ë¶€ ê³ ë¯¼ì€?",
        options: [
            { english: "Extreme dryness and cracking", korean: "ê·¹ì‹¬í•œ ê±´ì¡°í•¨ê³¼ ê°ˆë¼ì§", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Keeping skin healthy and glowing", korean: "í”¼ë¶€ë¥¼ ê±´ê°•í•˜ê³  ìœ¤ê¸°ìˆê²Œ ìœ ì§€", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Still dealing with oiliness and acne", korean: "ì—¬ì „íˆ ìœ ë¶„ê³¼ ì—¬ë“œë¦„ ê´€ë¦¬", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Different needs for different areas", korean: "ë¶€ìœ„ë³„ë¡œ ë‹¤ë¥¸ ì¼€ì–´ í•„ìš”", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Redness and reactive skin", korean: "í™ì¡°ì™€ ë¯¼ê° ë°˜ì‘", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    },
    {
        english: "How does your morning skincare absorb in winter?",
        korean: "ê²¨ìš¸ì— ì•„ì¹¨ ìŠ¤í‚¨ì¼€ì–´ í¡ìˆ˜ëŠ” ì–´ë–¤ê°€ìš”?",
        options: [
            { english: "Absorbs instantly, needs more", korean: "ì¦‰ì‹œ í¡ìˆ˜ë˜ê³ , ë” í•„ìš”í•¨", scores: { dry: 2, oily: 0, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Absorbs well at normal pace", korean: "ì ë‹¹í•œ ì†ë„ë¡œ ì˜ í¡ìˆ˜ë¨", scores: { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 2 } },
            { english: "Takes forever, sits on skin", korean: "ì˜¤ë˜ ê±¸ë¦¬ê³ , í”¼ë¶€ ìœ„ì— ë‚¨ìŒ", scores: { dry: 0, oily: 2, combination: 0, sensitive: 0, normal: 0 } },
            { english: "Quick on cheeks, slow on T-zone", korean: "ë³¼ì€ ë¹ ë¥´ê³ , Tì¡´ì€ ëŠë¦¼", scores: { dry: 0, oily: 0, combination: 2, sensitive: 0, normal: 0 } },
            { english: "Some products cause stinging", korean: "ì¼ë¶€ ì œí’ˆì´ ë”°ë”ê±°ë¦¼ ìœ ë°œ", scores: { dry: 0, oily: 0, combination: 0, sensitive: 2, normal: 0 } }
        ]
    }
];

// Skin Type Results Data
var skinTypeResults = {
    dry: {
        emoji: "ğŸœï¸",
        english: "Dry Skin",
        korean: "ê±´ì„± í”¼ë¶€",
        description: "Your skin lacks natural oils and moisture, often feeling tight and showing flakiness.",
        tips: [
            "ğŸ’§ Use gentle, hydrating cleansers",
            "ğŸ§´ Layer hydrating toners and essences",
            "ğŸŒ™ Apply rich cream moisturizers at night",
            "â˜€ï¸ Never skip sunscreen",
            "ğŸš« Avoid hot water and harsh exfoliants"
        ],
        products: [
            { name: "COSRX Snail Mucin Essence", brand: "COSRX", emoji: "ğŸŒ", link: "#" },
            { name: "Laneige Water Bank Cream", brand: "Laneige", emoji: "ğŸ’§", link: "#" },
            { name: "Etude SoonJung Toner", brand: "Etude", emoji: "ğŸŒ¿", link: "#" }
        ]
    },
    oily: {
        emoji: "âœ¨",
        english: "Oily Skin",
        korean: "ì§€ì„± í”¼ë¶€",
        description: "Your skin produces excess sebum, often looking shiny and prone to enlarged pores.",
        tips: [
            "ğŸ«§ Use gentle foaming cleansers twice daily",
            "ğŸ’¨ Look for lightweight, oil-free moisturizers",
            "ğŸ§ª Incorporate BHA/salicylic acid for pores",
            "ğŸ“ Use blotting papers during the day",
            "ğŸš« Do not skip moisturizer"
        ],
        products: [
            { name: "COSRX BHA Blackhead Power Liquid", brand: "COSRX", emoji: "ğŸ§ª", link: "#" },
            { name: "Innisfree No-Sebum Powder", brand: "Innisfree", emoji: "ğŸ’¨", link: "#" },
            { name: "Some By Mi AHA BHA PHA Toner", brand: "Some By Mi", emoji: "ğŸŒŸ", link: "#" }
        ]
    },
    combination: {
        emoji: "âš–ï¸",
        english: "Combination Skin",
        korean: "ë³µí•©ì„± í”¼ë¶€",
        description: "Your T-zone is oily while your cheeks are normal to dry.",
        tips: [
            "ğŸ¯ Use different products for different zones",
            "ğŸ§´ Gel moisturizers work well overall",
            "ğŸ”„ Multi-mask: clay on T-zone, hydrating on cheeks",
            "ğŸ’§ Focus hydration on dry areas",
            "ğŸ§ª Use BHA only on oily zones"
        ],
        products: [
            { name: "Klairs Supple Preparation Toner", brand: "Klairs", emoji: "ğŸ’§", link: "#" },
            { name: "Innisfree Green Tea Seed Serum", brand: "Innisfree", emoji: "ğŸµ", link: "#" },
            { name: "COSRX Oil-Free Moisturizing Lotion", brand: "COSRX", emoji: "ğŸŒŠ", link: "#" }
        ]
    },
    sensitive: {
        emoji: "ğŸŒ¸",
        english: "Sensitive Skin",
        korean: "ë¯¼ê°ì„± í”¼ë¶€",
        description: "Your skin easily reacts to products and environmental factors.",
        tips: [
            "ğŸŒ¿ Choose fragrance-free, hypoallergenic products",
            "ğŸ§ª Patch test ALL new products",
            "â„ï¸ Use lukewarm water, never hot",
            "ğŸ›¡ï¸ Look for centella, aloe, and ceramides",
            "ğŸš« Avoid alcohol and harsh actives"
        ],
        products: [
            { name: "Etude SoonJung 2x Barrier Cream", brand: "Etude", emoji: "ğŸ›¡ï¸", link: "#" },
            { name: "COSRX Centella Blemish Cream", brand: "COSRX", emoji: "ğŸŒ¿", link: "#" },
            { name: "Pyunkang Yul Essence Toner", brand: "Pyunkang Yul", emoji: "ğŸ’š", link: "#" }
        ]
    },
    normal: {
        emoji: "ğŸ˜Š",
        english: "Normal Skin",
        korean: "ì¤‘ì„± í”¼ë¶€",
        description: "Congratulations! Your skin is well-balanced with good moisture levels.",
        tips: [
            "âœ¨ Maintain with a simple, consistent routine",
            "â˜€ï¸ Prioritize sun protection",
            "ğŸ’§ Stay hydrated inside and out",
            "ğŸ”„ Can experiment with various products",
            "ğŸ˜´ Focus on getting enough sleep"
        ],
        products: [
            { name: "Beauty of Joseon Glow Serum", brand: "Beauty of Joseon", emoji: "âœ¨", link: "#" },
            { name: "Round Lab Dokdo Toner", brand: "Round Lab", emoji: "ğŸŒŠ", link: "#" },
            { name: "Isntree Hyaluronic Acid Toner", brand: "Isntree", emoji: "ğŸ’§", link: "#" }
        ]
    }
};

// ============================================================
// INGREDIENT ANALYZER â€” DB SWAP INSTRUCTIONS
// ============================================================
// The ONLY function you need to replace when moving to an
// external database or API is: lookupIngredient(rawName)
//
// It must return an object with this shape:
//   { found: true, data: { name, nameKr, category, rating,
//     comedogenic, irritation, description } }
//   OR
//   { found: false, query: "original input string" }
//
// Field reference:
//   name         (string)  â€” canonical English name
//   nameKr       (string)  â€” Korean name (optional, can be "")
//   category     (string)  â€” e.g. "active", "humectant", "emollient",
//                            "soothing", "sunscreen", "preservative",
//                            "fragrance", "surfactant", "base", "ferment"
//   rating       (string)  â€” "great" | "good" | "average" | "poor" | "bad"
//   comedogenic  (number)  â€” 0-5 scale
//   irritation   (number)  â€” 0-5 scale
//   description  (string)  â€” short benefit/concern summary
//
// To switch to an async API:
//   1. Change lookupIngredient() to return a Promise
//   2. In analyzeIngredients(), wrap the map in Promise.all():
//        var results = await Promise.all(names.map(n => lookupIngredient(n)));
//   3. Mark analyzeIngredients() as async
// ============================================================

var INGREDIENT_DB = [
    // â”€â”€ Actives â”€â”€
    { name: "Niacinamide", nameKr: "ë‚˜ì´ì•„ì‹ ì•„ë§ˆì´ë“œ", category: "active", rating: "great", comedogenic: 0, irritation: 0, description: "Brightens skin, minimizes pores, strengthens skin barrier, and reduces hyperpigmentation." },
    { name: "Vitamin C (Ascorbic Acid)", nameKr: "ë¹„íƒ€ë¯¼C", category: "active", rating: "great", comedogenic: 0, irritation: 1, description: "Potent antioxidant that brightens, boosts collagen, and protects against UV damage." },
    { name: "Retinol", nameKr: "ë ˆí‹°ë†€", category: "active", rating: "great", comedogenic: 0, irritation: 2, description: "Gold standard anti-aging ingredient. Speeds cell turnover, reduces wrinkles and dark spots." },
    { name: "Retinal (Retinaldehyde)", nameKr: "ë ˆí‹°ë‚ ", category: "active", rating: "great", comedogenic: 0, irritation: 2, description: "Stronger retinoid that converts directly to retinoic acid. Faster results than retinol." },
    { name: "Salicylic Acid (BHA)", nameKr: "ì‚´ë¦¬ì‹¤ì‚°", category: "active", rating: "great", comedogenic: 0, irritation: 1, description: "Oil-soluble acid that penetrates pores to clear blackheads, whiteheads, and acne." },
    { name: "Glycolic Acid (AHA)", nameKr: "ê¸€ë¦¬ì½œì‚°", category: "active", rating: "good", comedogenic: 0, irritation: 2, description: "Exfoliates dead skin cells for smoother, brighter skin. Can increase sun sensitivity." },
    { name: "Lactic Acid", nameKr: "ì –ì‚°", category: "active", rating: "good", comedogenic: 0, irritation: 1, description: "Gentle AHA that exfoliates and hydrates. Good for sensitive skin and beginners." },
    { name: "Mandelic Acid", nameKr: "ë§Œë¸ì‚°", category: "active", rating: "good", comedogenic: 0, irritation: 1, description: "Gentle AHA with antibacterial properties. Great for acne-prone and darker skin tones." },
    { name: "Azelaic Acid", nameKr: "ì•„ì ¤ë¼ì‚°", category: "active", rating: "great", comedogenic: 0, irritation: 1, description: "Treats acne, rosacea, and hyperpigmentation. Anti-inflammatory and antibacterial." },
    { name: "Tranexamic Acid", nameKr: "íŠ¸ë¼ë„¥ì‚¼ì‚°", category: "active", rating: "great", comedogenic: 0, irritation: 0, description: "Targets stubborn hyperpigmentation and melasma. Safe for all skin tones." },
    { name: "Alpha-Arbutin", nameKr: "ì•ŒíŒŒì•Œë¶€í‹´", category: "active", rating: "great", comedogenic: 0, irritation: 0, description: "Brightening agent that inhibits melanin production. Safer alternative to hydroquinone." },
    { name: "Adenosine", nameKr: "ì•„ë°ë…¸ì‹ ", category: "active", rating: "good", comedogenic: 0, irritation: 0, description: "Anti-wrinkle ingredient commonly used in K-beauty. Soothes and promotes skin repair." },
    { name: "Bakuchiol", nameKr: "ë°”ì¿ ì¹˜ì˜¬", category: "active", rating: "good", comedogenic: 0, irritation: 0, description: "Plant-based retinol alternative. Anti-aging benefits without irritation or sun sensitivity." },
    { name: "Peptides", nameKr: "í©íƒ€ì´ë“œ", category: "active", rating: "good", comedogenic: 0, irritation: 0, description: "Signal skin to produce more collagen. Anti-aging benefits with minimal irritation." },
    { name: "Copper Peptides", nameKr: "êµ¬ë¦¬ í©íƒ€ì´ë“œ", category: "active", rating: "good", comedogenic: 0, irritation: 0, description: "Promotes collagen and elastin production, supports wound healing and skin remodeling." },
    { name: "Benzoyl Peroxide", nameKr: "ë²¤ì¡°ì¼í¼ì˜¥ì‚¬ì´ë“œ", category: "active", rating: "good", comedogenic: 0, irritation: 2, description: "Kills acne-causing bacteria. Effective but can be drying and irritating." },
    { name: "Kojic Acid", nameKr: "ì½”ì§ì‚°", category: "active", rating: "good", comedogenic: 0, irritation: 1, description: "Brightening agent derived from fungi. Inhibits melanin production for a more even tone." },
    { name: "Ferulic Acid", nameKr: "í˜ë£°ì‚°", category: "active", rating: "good", comedogenic: 0, irritation: 0, description: "Antioxidant that boosts the efficacy of vitamins C and E. Protects against free radicals." },

    // â”€â”€ Humectants â”€â”€
    { name: "Glycerin", nameKr: "ê¸€ë¦¬ì„¸ë¦°", category: "humectant", rating: "great", comedogenic: 0, irritation: 0, description: "One of the best moisturizing ingredients. Draws water to skin and strengthens barrier." },
    { name: "Hyaluronic Acid", nameKr: "íˆì•Œë£¨ë¡ ì‚°", category: "humectant", rating: "great", comedogenic: 0, irritation: 0, description: "Holds up to 1000x its weight in water. Plumps skin and reduces fine lines." },
    { name: "Panthenol (Vitamin B5)", nameKr: "íŒí…Œë†€", category: "humectant", rating: "great", comedogenic: 0, irritation: 0, description: "Deeply hydrates, soothes irritation, and supports skin barrier repair." },
    { name: "Betaine", nameKr: "ë² íƒ€ì¸", category: "humectant", rating: "good", comedogenic: 0, irritation: 0, description: "Natural amino acid that hydrates and protects against environmental stress." },
    { name: "Beta-Glucan", nameKr: "ë² íƒ€ê¸€ë£¨ì¹¸", category: "humectant", rating: "great", comedogenic: 0, irritation: 0, description: "Powerful hydrator with soothing and anti-aging properties. Stimulates collagen production." },
    { name: "Urea", nameKr: "ìš°ë ˆì•„", category: "humectant", rating: "good", comedogenic: 0, irritation: 1, description: "Hydrates and gently exfoliates. Great for very dry or rough skin." },
    { name: "Sodium Hyaluronate", nameKr: "íˆì•Œë£¨ë¡ ì‚°ë‚˜íŠ¸ë¥¨", category: "humectant", rating: "great", comedogenic: 0, irritation: 0, description: "Smaller form of hyaluronic acid that penetrates deeper into skin for intense hydration." },
    { name: "Propanediol", nameKr: "í”„ë¡œíŒë””ì˜¬", category: "humectant", rating: "good", comedogenic: 0, irritation: 0, description: "Plant-derived humectant and solvent. Helps other ingredients absorb better." },
    { name: "Butylene Glycol", nameKr: "ë¶€í‹¸ë Œê¸€ë¼ì´ì½œ", category: "humectant", rating: "good", comedogenic: 1, irritation: 0, description: "Lightweight moisturizer and solvent commonly used in K-beauty formulations." },
    { name: "1,2-Hexanediol", nameKr: "1,2-í—¥ì‚°ë””ì˜¬", category: "humectant", rating: "average", comedogenic: 0, irritation: 0, description: "Humectant with mild preservative properties. Common in K-beauty formulations." },

    // â”€â”€ Emollients & Occlusives â”€â”€
    { name: "Squalane", nameKr: "ìŠ¤ì¿ ì•Œë€", category: "emollient", rating: "great", comedogenic: 0, irritation: 0, description: "Lightweight oil identical to skin's natural sebum. Moisturizes without clogging pores." },
    { name: "Ceramides", nameKr: "ì„¸ë¼ë§ˆì´ë“œ", category: "emollient", rating: "great", comedogenic: 0, irritation: 0, description: "Essential lipids that form the skin barrier. Repair and protect against moisture loss." },
    { name: "Shea Butter", nameKr: "ì‹œì–´ë²„í„°", category: "emollient", rating: "good", comedogenic: 0, irritation: 0, description: "Rich emollient that deeply moisturizes and protects dry skin." },
    { name: "Jojoba Oil", nameKr: "í˜¸í˜¸ë°”ì˜¤ì¼", category: "emollient", rating: "good", comedogenic: 2, irritation: 0, description: "Closest oil to skin's natural sebum. Balances oil production and moisturizes." },
    { name: "Cetearyl Alcohol", nameKr: "ì„¸í…Œì•„ë¦´ì•Œì½”ì˜¬", category: "emollient", rating: "good", comedogenic: 1, irritation: 0, description: "Fatty alcohol (not drying alcohol). Softens and smooths skin texture." },
    { name: "Cetyl Alcohol", nameKr: "ì„¸í‹¸ì•Œì½”ì˜¬", category: "emollient", rating: "good", comedogenic: 1, irritation: 0, description: "Fatty alcohol that acts as an emollient and thickener. Not drying." },
    { name: "Dimethicone", nameKr: "ë””ë©”ì¹˜ì½˜", category: "emollient", rating: "good", comedogenic: 1, irritation: 0, description: "Silicone that creates a smooth, protective barrier. Gives products a silky feel." },
    { name: "Petrolatum", nameKr: "í˜íŠ¸ë¡¤ë¼íˆ¼", category: "emollient", rating: "good", comedogenic: 0, irritation: 0, description: "Powerful occlusive that seals in moisture. Effective for very dry skin." },
    { name: "Mineral Oil", nameKr: "ë¯¸ë„¤ë„ì˜¤ì¼", category: "emollient", rating: "average", comedogenic: 2, irritation: 0, description: "Occlusive moisturizer. Effective but some prefer plant-based alternatives." },
    { name: "Rosehip Oil", nameKr: "ë¡œì¦ˆí™ì˜¤ì¼", category: "emollient", rating: "good", comedogenic: 1, irritation: 0, description: "Rich in vitamins A and C. Hydrates, brightens, and helps with scarring." },
    { name: "Sunflower Seed Oil", nameKr: "í•´ë°”ë¼ê¸°ì”¨ì˜¤ì¼", category: "emollient", rating: "good", comedogenic: 0, irritation: 0, description: "Lightweight oil rich in linoleic acid. Helps strengthen skin barrier." },
    { name: "Caprylic/Capric Triglyceride", nameKr: "ì¹´í”„ë¦´ë¦­/ì¹´í”„ë¦­íŠ¸ë¦¬ê¸€ë¦¬ì„¸ë¼ì´ë“œ", category: "emollient", rating: "good", comedogenic: 1, irritation: 0, description: "Coconut-derived emollient that smooths and softens skin without greasiness." },
    { name: "Stearic Acid", nameKr: "ìŠ¤í…Œì•„ë¥´ì‚°", category: "emollient", rating: "average", comedogenic: 2, irritation: 0, description: "Fatty acid used as an emulsifier and texture enhancer. May be mildly comedogenic." },

    // â”€â”€ Soothing & Botanical â”€â”€
    { name: "Centella Asiatica (CICA)", nameKr: "ë³‘í’€ì¶”ì¶œë¬¼", category: "soothing", rating: "great", comedogenic: 0, irritation: 0, description: "K-beauty star ingredient. Calms inflammation, speeds healing, strengthens barrier." },
    { name: "Madecassoside", nameKr: "ë§ˆë°ì¹´ì†Œì‚¬ì´ë“œ", category: "soothing", rating: "great", comedogenic: 0, irritation: 0, description: "Active compound from Centella. Powerful anti-inflammatory and wound healer." },
    { name: "Aloe Vera", nameKr: "ì•Œë¡œì— ë² ë¼", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Classic soothing ingredient. Hydrates, calms irritation, and supports healing." },
    { name: "Bisabolol", nameKr: "ë¹„ì‚¬ë³¼ì˜¬", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Derived from chamomile. Anti-inflammatory and soothing for sensitive skin." },
    { name: "Green Tea Extract", nameKr: "ë…¹ì°¨ì¶”ì¶œë¬¼", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Rich in EGCG antioxidants. Protects, soothes, and helps control oil production." },
    { name: "Licorice Root Extract", nameKr: "ê°ì´ˆì¶”ì¶œë¬¼", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Brightens dark spots, calms inflammation, and evens skin tone." },
    { name: "Tea Tree Oil", nameKr: "í‹°íŠ¸ë¦¬ì˜¤ì¼", category: "soothing", rating: "good", comedogenic: 1, irritation: 1, description: "Natural antibacterial and anti-inflammatory. Popular for acne-prone skin." },
    { name: "Mugwort (Artemisia)", nameKr: "ì‘¥ ì¶”ì¶œë¬¼", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Traditional Korean ingredient that calms sensitive and irritated skin." },
    { name: "Calendula Extract", nameKr: "ì¹´ë Œë“ˆë¼ì¶”ì¶œë¬¼", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Gentle anti-inflammatory that soothes and supports wound healing." },
    { name: "Chamomile Extract", nameKr: "ì¹´ëª¨ë§ˆì¼ì¶”ì¶œë¬¼", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Anti-inflammatory and calming. Good for sensitive and redness-prone skin." },
    { name: "Allantoin", nameKr: "ì•Œë€í† ì¸", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Soothes irritation and promotes cell regeneration. Very gentle on skin." },
    { name: "Tocopherol (Vitamin E)", nameKr: "í† ì½”í˜ë¡¤", category: "soothing", rating: "good", comedogenic: 2, irritation: 0, description: "Antioxidant that protects skin from free radicals and supports barrier function." },

    // â”€â”€ Sunscreen Filters â”€â”€
    { name: "Zinc Oxide", nameKr: "ì§•í¬ì˜¥ì‚¬ì´ë“œ", category: "sunscreen", rating: "great", comedogenic: 0, irritation: 0, description: "Physical/mineral UV filter. Broad-spectrum protection, gentle on sensitive skin." },
    { name: "Titanium Dioxide", nameKr: "í‹°íƒ€ëŠ„ë””ì˜¥ì‚¬ì´ë“œ", category: "sunscreen", rating: "great", comedogenic: 0, irritation: 0, description: "Physical/mineral UV filter. Protects against UVB and some UVA rays." },
    { name: "Ethylhexyl Methoxycinnamate (Octinoxate)", nameKr: "ì˜¥í‹°ë…¹ì„¸ì´íŠ¸", category: "sunscreen", rating: "average", comedogenic: 0, irritation: 1, description: "Chemical UVB filter. Effective but some concerns about hormone disruption." },

    // â”€â”€ Ferments (K-beauty Specialty) â”€â”€
    { name: "Galactomyces Ferment Filtrate", nameKr: "ê°ˆë½í† ë¯¸ì„¸ìŠ¤ ë°œíš¨ì—¬ê³¼ë¬¼", category: "ferment", rating: "great", comedogenic: 0, irritation: 0, description: "Brightens, hydrates, and improves skin texture. Star ingredient of many K-beauty essences." },
    { name: "Saccharomyces Ferment Filtrate", nameKr: "ì‚¬ì¹´ë¡œë¯¸ì„¸ìŠ¤ ë°œíš¨ì—¬ê³¼ë¬¼", category: "ferment", rating: "good", comedogenic: 0, irritation: 0, description: "Yeast-derived ferment that hydrates and promotes radiant, healthy-looking skin." },
    { name: "Bifida Ferment Lysate", nameKr: "ë¹„í”¼ë‹¤ ë°œíš¨ ìš©í•´ë¬¼", category: "ferment", rating: "good", comedogenic: 0, irritation: 0, description: "Probiotic ingredient that strengthens skin barrier and improves elasticity." },
    { name: "Rice Ferment Filtrate (Sake)", nameKr: "ìŒ€ ë°œíš¨ ì—¬ê³¼ë¬¼", category: "ferment", rating: "good", comedogenic: 0, irritation: 0, description: "Traditional Asian brightening ingredient. Rich in vitamins and amino acids." },

    // â”€â”€ K-beauty Staples â”€â”€
    { name: "Snail Mucin (Secretion Filtrate)", nameKr: "ë‹¬íŒ½ì´ ì ì•¡ ì—¬ê³¼ë¬¼", category: "soothing", rating: "great", comedogenic: 0, irritation: 0, description: "K-beauty hero ingredient. Deeply hydrates, repairs, and promotes healing." },
    { name: "Propolis Extract", nameKr: "í”„ë¡œí´ë¦¬ìŠ¤ ì¶”ì¶œë¬¼", category: "soothing", rating: "great", comedogenic: 0, irritation: 0, description: "Bee-derived ingredient with antibacterial, anti-inflammatory, and healing properties." },
    { name: "Honey Extract", nameKr: "ê¿€ ì¶”ì¶œë¬¼", category: "humectant", rating: "good", comedogenic: 0, irritation: 0, description: "Natural humectant with antibacterial properties. Soothes and hydrates skin." },
    { name: "Rice Extract", nameKr: "ìŒ€ ì¶”ì¶œë¬¼", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Brightens skin and improves texture. Rich in vitamins and minerals." },
    { name: "Ginseng Extract", nameKr: "ì¸ì‚¼ ì¶”ì¶œë¬¼", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Revitalizes skin, boosts circulation, and provides anti-aging benefits." },

    // â”€â”€ Base / Solvent â”€â”€
    { name: "Water", nameKr: "ì •ì œìˆ˜", category: "base", rating: "good", comedogenic: 0, irritation: 0, description: "Universal solvent and base of most skincare formulations." },
    { name: "Ethyl Hexanediol", nameKr: "ì—í‹¸í—¥ì‚°ë””ì˜¬", category: "base", rating: "average", comedogenic: 0, irritation: 1, description: "Solvent and mild preservative booster. Common in K-beauty formulations." },

    // â”€â”€ Preservatives â”€â”€
    { name: "Phenoxyethanol", nameKr: "í˜ë…¹ì‹œì—íƒ„ì˜¬", category: "preservative", rating: "average", comedogenic: 0, irritation: 1, description: "Widely used preservative considered safer than parabens. Generally well tolerated." },
    { name: "Ethylhexylglycerin", nameKr: "ì—í‹¸í—¥ì‹¤ê¸€ë¦¬ì„¸ë¦°", category: "preservative", rating: "good", comedogenic: 0, irritation: 0, description: "Mild preservative booster and skin-conditioning agent." },
    { name: "Methylparaben", nameKr: "ë©”í‹¸íŒŒë¼ë²¤", category: "preservative", rating: "poor", comedogenic: 0, irritation: 1, description: "Paraben preservative. Some concerns about hormone disruption; widely debated safety." },
    { name: "Propylparaben", nameKr: "í”„ë¡œí•„íŒŒë¼ë²¤", category: "preservative", rating: "poor", comedogenic: 0, irritation: 1, description: "Paraben preservative. More controversial than methylparaben; some prefer paraben-free." },

    // â”€â”€ Thickeners / Texture â”€â”€
    { name: "Carbomer", nameKr: "ì¹´ë³´ë¨¸", category: "base", rating: "good", comedogenic: 0, irritation: 0, description: "Gel-forming thickener that gives products their texture. Very safe." },
    { name: "Xanthan Gum", nameKr: "ì”íƒ„ê²€", category: "base", rating: "good", comedogenic: 0, irritation: 0, description: "Natural thickener and stabilizer derived from bacteria fermentation." },
    { name: "Sodium Polyacrylate", nameKr: "ì†Œë””ì›€í´ë¦¬ì•„í¬ë¦´ë ˆì´íŠ¸", category: "base", rating: "average", comedogenic: 0, irritation: 0, description: "Synthetic thickener and texture agent. Holds water and creates gel textures." },

    // â”€â”€ Emulsifiers â”€â”€
    { name: "Polysorbate 20", nameKr: "í´ë¦¬ì†Œë¥´ë² ì´íŠ¸ 20", category: "base", rating: "average", comedogenic: 0, irritation: 0, description: "Emulsifier that helps mix oil and water ingredients together." },
    { name: "Polysorbate 60", nameKr: "í´ë¦¬ì†Œë¥´ë² ì´íŠ¸ 60", category: "base", rating: "average", comedogenic: 2, irritation: 0, description: "Emulsifier used to stabilize formulations. Mildly comedogenic." },
    { name: "Cetearyl Olivate", nameKr: "ì„¸í…Œì•„ë¦´ì˜¬ë¦¬ë² ì´íŠ¸", category: "base", rating: "good", comedogenic: 0, irritation: 0, description: "Olive-derived emulsifier. Gentle and moisturizing." },
    { name: "Sorbitan Olivate", nameKr: "ì†Œë¥´ë¹„íƒ„ì˜¬ë¦¬ë² ì´íŠ¸", category: "base", rating: "good", comedogenic: 0, irritation: 0, description: "Olive-derived emulsifier often paired with cetearyl olivate." },

    // â”€â”€ Caution / Avoid â”€â”€
    { name: "Fragrance (Parfum)", nameKr: "í–¥ë£Œ", category: "fragrance", rating: "poor", comedogenic: 0, irritation: 3, description: "Common irritant and allergen. Leading cause of cosmetic contact dermatitis." },
    { name: "Denatured Alcohol (Alcohol Denat.)", nameKr: "ë³€ì„±ì•Œì½”ì˜¬", category: "base", rating: "poor", comedogenic: 0, irritation: 2, description: "Drying alcohol that can damage skin barrier. Especially bad for dry/sensitive skin." },
    { name: "Sodium Lauryl Sulfate (SLS)", nameKr: "ì†Œë“ë¼ìš°ë¦´ì„¤í˜ì´íŠ¸", category: "surfactant", rating: "bad", comedogenic: 0, irritation: 3, description: "Harsh surfactant that strips skin's natural oils. Known irritant â€” avoid in leave-on products." },
    { name: "Sodium Laureth Sulfate (SLES)", nameKr: "ì†Œë“ë¼ìš°ë ˆìŠ¤ì„¤í˜ì´íŠ¸", category: "surfactant", rating: "poor", comedogenic: 0, irritation: 2, description: "Milder than SLS but still a potential irritant. Common in cleansers." },
    { name: "Isopropyl Myristate", nameKr: "ì´ì†Œí”„ë¡œí•„ë¯¸ë¦¬ìŠ¤í…Œì´íŠ¸", category: "emollient", rating: "poor", comedogenic: 5, irritation: 0, description: "Highly comedogenic emollient. Can clog pores and trigger breakouts." },
    { name: "Coconut Oil", nameKr: "ì½”ì½”ë„›ì˜¤ì¼", category: "emollient", rating: "average", comedogenic: 4, irritation: 0, description: "Very moisturizing but highly comedogenic. Best for body, risky on face." },
    { name: "Isopropyl Palmitate", nameKr: "ì´ì†Œí”„ë¡œí•„íŒ”ë¯¸í…Œì´íŠ¸", category: "emollient", rating: "poor", comedogenic: 4, irritation: 0, description: "Emollient with high comedogenic rating. May trigger breakouts in acne-prone skin." },
    { name: "Formaldehyde Releasers (DMDM Hydantoin)", nameKr: "í¬ë¦„ì•Œë°íˆë“œ ë°©ì¶œì œ", category: "preservative", rating: "bad", comedogenic: 0, irritation: 3, description: "Releases formaldehyde over time. Known irritant and sensitizer â€” best avoided." },
    { name: "CI 77491 (Iron Oxides)", nameKr: "ì‚°í™”ì² ", category: "base", rating: "good", comedogenic: 0, irritation: 0, description: "Pigment used for color in tinted products. Safe and non-irritating." },

    // â”€â”€ Amino Acids â”€â”€
    { name: "Arginine", nameKr: "ì•„ë¥´ê¸°ë‹Œ", category: "humectant", rating: "good", comedogenic: 0, irritation: 0, description: "Amino acid that helps repair skin barrier and maintain hydration." },

    // â”€â”€ Additional common ingredients â”€â”€
    { name: "Centella Asiatica Leaf Water", nameKr: "ë³‘í’€ììˆ˜", category: "soothing", rating: "good", comedogenic: 0, irritation: 0, description: "Water infused with centella. Provides mild soothing and hydrating benefits." },
    { name: "Sodium PCA", nameKr: "ì†Œë“PCA", category: "humectant", rating: "good", comedogenic: 0, irritation: 0, description: "Natural moisturizing factor (NMF) component. Excellent hydrator." },
    { name: "Trehalose", nameKr: "íŠ¸ë ˆí• ë¡œìŠ¤", category: "humectant", rating: "good", comedogenic: 0, irritation: 0, description: "Sugar-derived humectant that protects cells from dehydration." },
    { name: "Lecithin", nameKr: "ë ˆì‹œí‹´", category: "emollient", rating: "good", comedogenic: 0, irritation: 0, description: "Phospholipid that helps deliver active ingredients and moisturizes." },
    { name: "Ascorbyl Glucoside", nameKr: "ì•„ìŠ¤ì½”ë¥´ë¹Œê¸€ë£¨ì½”ì‚¬ì´ë“œ", category: "active", rating: "good", comedogenic: 0, irritation: 0, description: "Stable vitamin C derivative. Brightens and provides antioxidant protection." },
    { name: "Ethylhexyl Palmitate", nameKr: "ì—í‹¸í—¥ì‹¤íŒ”ë¯¸í…Œì´íŠ¸", category: "emollient", rating: "average", comedogenic: 2, irritation: 0, description: "Emollient ester used as a skin-conditioning agent." },
    { name: "Hydrogenated Lecithin", nameKr: "ìˆ˜ì†Œí™”ë ˆì‹œí‹´", category: "emollient", rating: "good", comedogenic: 0, irritation: 0, description: "Stabilized lecithin used as an emulsifier and skin barrier supporter." },
    { name: "EDTA", nameKr: "EDTA", category: "base", rating: "average", comedogenic: 0, irritation: 0, description: "Chelating agent that improves product stability by binding to metal ions." },
    { name: "Triethanolamine", nameKr: "íŠ¸ë¦¬ì—íƒ„ì˜¬ì•„ë¯¼", category: "base", rating: "average", comedogenic: 0, irritation: 1, description: "pH adjuster and emulsifier. Generally safe in small concentrations." },
    { name: "BHT", nameKr: "BHT", category: "preservative", rating: "average", comedogenic: 0, irritation: 1, description: "Synthetic antioxidant preservative. Debated safety profile." },
    { name: "Citric Acid", nameKr: "êµ¬ì—°ì‚°", category: "base", rating: "good", comedogenic: 0, irritation: 0, description: "Used as a pH adjuster. In low concentrations, also provides mild exfoliation." }
];

var INGREDIENT_ALIASES = {
    // Hyaluronic Acid variants
    "sodium hyaluronate": "Hyaluronic Acid",
    "hyaluronate": "Hyaluronic Acid",
    "ha": "Hyaluronic Acid",
    // Vitamin C variants
    "ascorbic acid": "Vitamin C (Ascorbic Acid)",
    "l-ascorbic acid": "Vitamin C (Ascorbic Acid)",
    "ethyl ascorbic acid": "Ascorbyl Glucoside",
    "3-o-ethyl ascorbic acid": "Ascorbyl Glucoside",
    // Retinoids
    "retinaldehyde": "Retinal (Retinaldehyde)",
    "vitamin a": "Retinol",
    // BHA / AHA
    "bha": "Salicylic Acid (BHA)",
    "aha": "Glycolic Acid (AHA)",
    "glycolic acid": "Glycolic Acid (AHA)",
    "salicylic acid": "Salicylic Acid (BHA)",
    // Niacinamide
    "vitamin b3": "Niacinamide",
    "nicotinamide": "Niacinamide",
    // Panthenol
    "panthenol": "Panthenol (Vitamin B5)",
    "dexpanthenol": "Panthenol (Vitamin B5)",
    "d-panthenol": "Panthenol (Vitamin B5)",
    "vitamin b5": "Panthenol (Vitamin B5)",
    "pro-vitamin b5": "Panthenol (Vitamin B5)",
    // CICA
    "centella asiatica": "Centella Asiatica (CICA)",
    "centella asiatica extract": "Centella Asiatica (CICA)",
    "cica": "Centella Asiatica (CICA)",
    "gotu kola": "Centella Asiatica (CICA)",
    // Snail
    "snail secretion filtrate": "Snail Mucin (Secretion Filtrate)",
    "snail mucin": "Snail Mucin (Secretion Filtrate)",
    "snail mucin extract": "Snail Mucin (Secretion Filtrate)",
    // Ceramides
    "ceramide np": "Ceramides",
    "ceramide ap": "Ceramides",
    "ceramide eop": "Ceramides",
    "ceramide ns": "Ceramides",
    "ceramide 3": "Ceramides",
    // Fragrance
    "fragrance": "Fragrance (Parfum)",
    "parfum": "Fragrance (Parfum)",
    // Alcohol
    "alcohol denat": "Denatured Alcohol (Alcohol Denat.)",
    "alcohol denat.": "Denatured Alcohol (Alcohol Denat.)",
    "sd alcohol": "Denatured Alcohol (Alcohol Denat.)",
    // SLS / SLES
    "sls": "Sodium Lauryl Sulfate (SLS)",
    "sodium lauryl sulfate": "Sodium Lauryl Sulfate (SLS)",
    "sles": "Sodium Laureth Sulfate (SLES)",
    "sodium laureth sulfate": "Sodium Laureth Sulfate (SLES)",
    // Ferments
    "galactomyces": "Galactomyces Ferment Filtrate",
    "saccharomyces": "Saccharomyces Ferment Filtrate",
    "bifida lysate": "Bifida Ferment Lysate",
    "bifida ferment lysate": "Bifida Ferment Lysate",
    // Oils
    "cocos nucifera oil": "Coconut Oil",
    "coconut oil": "Coconut Oil",
    "simmondsia chinensis seed oil": "Jojoba Oil",
    "jojoba oil": "Jojoba Oil",
    "helianthus annuus seed oil": "Sunflower Seed Oil",
    "rosa canina fruit oil": "Rosehip Oil",
    "rosehip seed oil": "Rosehip Oil",
    "butyrospermum parkii butter": "Shea Butter",
    "shea butter": "Shea Butter",
    // Aloe
    "aloe barbadensis leaf extract": "Aloe Vera",
    "aloe barbadensis leaf juice": "Aloe Vera",
    "aloe barbadensis": "Aloe Vera",
    // Tea tree
    "melaleuca alternifolia leaf oil": "Tea Tree Oil",
    "tea tree oil": "Tea Tree Oil",
    // Vitamin E
    "tocopherol": "Tocopherol (Vitamin E)",
    "tocopheryl acetate": "Tocopherol (Vitamin E)",
    "vitamin e": "Tocopherol (Vitamin E)",
    // Green tea
    "camellia sinensis leaf extract": "Green Tea Extract",
    "green tea": "Green Tea Extract",
    // Licorice
    "glycyrrhiza glabra root extract": "Licorice Root Extract",
    "licorice root": "Licorice Root Extract",
    // Propolis
    "propolis": "Propolis Extract",
    "propolis extract": "Propolis Extract",
    // Sunscreen
    "octinoxate": "Ethylhexyl Methoxycinnamate (Octinoxate)",
    "ethylhexyl methoxycinnamate": "Ethylhexyl Methoxycinnamate (Octinoxate)",
    // DMDM
    "dmdm hydantoin": "Formaldehyde Releasers (DMDM Hydantoin)",
    // Others
    "aqua": "Water",
    "purified water": "Water",
    "iron oxides": "CI 77491 (Iron Oxides)",
    "disodium edta": "EDTA",
    "disodium edetate": "EDTA"
};

// Build a lowercase lookup map from INGREDIENT_DB for fast exact matching
var _ingredientMap = {};
var _ingredientMapKr = {};
INGREDIENT_DB.forEach(function(entry) {
    _ingredientMap[entry.name.toLowerCase()] = entry;
    if (entry.nameKr) {
        _ingredientMapKr[entry.nameKr.toLowerCase()] = entry;
    }
});

function lookupIngredient(rawName) {
    var query = rawName.trim();
    if (!query) return { found: false, query: rawName };

    var lower = query.toLowerCase();

    // Tier 1: Check aliases first
    if (INGREDIENT_ALIASES[lower]) {
        var canonical = INGREDIENT_ALIASES[lower];
        var entry = _ingredientMap[canonical.toLowerCase()];
        if (entry) return { found: true, data: entry };
    }

    // Tier 2: Exact name match (English)
    if (_ingredientMap[lower]) {
        return { found: true, data: _ingredientMap[lower] };
    }

    // Tier 2.5: Exact Korean name match
    if (_ingredientMapKr[lower]) {
        return { found: true, data: _ingredientMapKr[lower] };
    }

    // Tier 3: Substring match (DB name contained in query, or query contained in DB name)
    for (var i = 0; i < INGREDIENT_DB.length; i++) {
        var dbLower = INGREDIENT_DB[i].name.toLowerCase();
        if (lower.indexOf(dbLower) !== -1 || dbLower.indexOf(lower) !== -1) {
            return { found: true, data: INGREDIENT_DB[i] };
        }
        // Also check Korean name substring match
        if (INGREDIENT_DB[i].nameKr) {
            var krLower = INGREDIENT_DB[i].nameKr.toLowerCase();
            if (lower.indexOf(krLower) !== -1 || krLower.indexOf(lower) !== -1) {
                return { found: true, data: INGREDIENT_DB[i] };
            }
        }
    }

    return { found: false, query: query };
}

function analyzeIngredients() {
    var input = document.getElementById('analyzer-input').value.trim();
    if (!input) return;

    var names = input.split(/,(?![^()]*\))/).map(function(s) { return s.trim(); }).filter(Boolean);
    var results = names.map(function(n) { return lookupIngredient(n); });

    var recognized = results.filter(function(r) { return r.found; });
    var unknown = results.filter(function(r) { return !r.found; });

    var actives = recognized.filter(function(r) {
        return r.data.rating === 'great' && (r.data.category === 'active' || r.data.category === 'ferment' || r.data.category === 'soothing');
    });
    var warnings = recognized.filter(function(r) {
        return r.data.rating === 'poor' || r.data.rating === 'bad';
    });

    renderAnalysisResults(recognized, unknown, actives, warnings);
}

function renderAnalysisResults(recognized, unknown, actives, warnings) {
    var container = document.getElementById('analyzer-results');
    var html = '';

    // Summary stats
    html += '<div class="analyzer-summary">';
    html += '<div class="analyzer-stat"><span class="analyzer-stat-num">' + recognized.length + '</span><span class="analyzer-stat-label">Recognized</span></div>';
    html += '<div class="analyzer-stat"><span class="analyzer-stat-num">' + actives.length + '</span><span class="analyzer-stat-label">Key Actives</span></div>';
    html += '<div class="analyzer-stat"><span class="analyzer-stat-num">' + warnings.length + '</span><span class="analyzer-stat-label">Warnings</span></div>';
    html += '<div class="analyzer-stat"><span class="analyzer-stat-num">' + unknown.length + '</span><span class="analyzer-stat-label">Unknown</span></div>';
    html += '</div>';

    // Key Actives
    if (actives.length > 0) {
        html += '<div class="analyzer-section-title">Key Actives</div>';
        actives.forEach(function(r) {
            html += renderIngredientRow(r.data, 'analyzer-row-active');
        });
    }

    // Warnings
    if (warnings.length > 0) {
        html += '<div class="analyzer-section-title">Warnings</div>';
        warnings.forEach(function(r) {
            html += renderIngredientRow(r.data, 'analyzer-row-warn');
        });
    }

    // Full Breakdown
    if (recognized.length > 0) {
        html += '<div class="analyzer-section-title">Full Breakdown (' + recognized.length + ' ingredients)</div>';
        recognized.forEach(function(r) {
            html += renderIngredientRow(r.data, '');
        });
    }

    // Unknown
    if (unknown.length > 0) {
        html += '<div class="analyzer-section-title">Not Recognized (' + unknown.length + ')</div>';
        html += '<div class="analyzer-unknown-list">';
        unknown.forEach(function(r) {
            html += '<span class="analyzer-unknown-tag">' + r.query + '</span>';
        });
        html += '</div>';
    }

    container.innerHTML = html;
}

function renderIngredientRow(data, extraClass) {
    var meta = [];
    if (data.category) meta.push(data.category);
    if (data.comedogenic > 0) meta.push('comedogenic: ' + data.comedogenic + '/5');
    if (data.irritation > 0) meta.push('irritation: ' + data.irritation + '/5');

    var html = '<div class="analyzer-row ' + extraClass + '">';
    html += '<span class="analyzer-badge rating-' + data.rating + '">' + data.rating + '</span>';
    html += '<div class="analyzer-row-info">';
    html += '<div class="analyzer-row-name">' + data.name;
    if (data.nameKr) html += '<span class="analyzer-row-name-kr">' + data.nameKr + '</span>';
    html += '</div>';
    if (meta.length > 0) html += '<div class="analyzer-row-meta">' + meta.join(' Â· ') + '</div>';
    html += '<div class="analyzer-row-desc">' + data.description + '</div>';
    html += '</div></div>';
    return html;
}

function clearAnalyzer() {
    document.getElementById('analyzer-input').value = '';
    document.getElementById('analyzer-results').innerHTML = '';
}

// Clinics Data
var clinicsData = [
    {
        name: "Oracle Dermatology",
        korean: "ì˜¤ë¼í´í”¼ë¶€ê³¼",
        area: "Gangnam Station",
        areaKr: "ê°•ë‚¨ì—­",
        rating: 4.8,
        reviews: 324,
        specialties: ["botox", "filler", "laser", "pico", "skinbooster"],
        priceRange: "â‚©â‚©",
        popular: "Botox, Rejuran",
        lat: 37.4979,
        lng: 127.0276,
        naverPlaceId: "1100410036",
        englishOk: true
    },
    {
        name: "April31 Plastic Surgery",
        korean: "ì—ì´í”„ë¦´31ì„±í˜•ì™¸ê³¼",
        area: "Sinnonhyeon",
        areaKr: "ì‹ ë…¼í˜„",
        rating: 4.7,
        reviews: 512,
        specialties: ["filler", "botox", "lifting", "thread"],
        priceRange: "â‚©â‚©â‚©",
        popular: "Filler, Ulthera, Thread Lift",
        lat: 37.5045,
        lng: 127.0254,
        naverPlaceId: "38453063",
        englishOk: true
    },
    {
        name: "Renewme Skin Clinic",
        korean: "ë¦¬ë‰´ë¯¸í”¼ë¶€ê³¼",
        area: "Gangnam Station",
        areaKr: "ê°•ë‚¨ì—­",
        rating: 4.6,
        reviews: 187,
        specialties: ["laser", "skinbooster", "pico", "aquapeel"],
        priceRange: "â‚©â‚©",
        popular: "Laser Toning, Skin Booster",
        lat: 37.4968,
        lng: 127.0284,
        naverPlaceId: "1224498562",
        englishOk: false
    },
    {
        name: "Seran Dermatology",
        korean: "ì„¸ë€í”¼ë¶€ê³¼",
        area: "Cheongdam",
        areaKr: "ì²­ë‹´",
        rating: 4.9,
        reviews: 203,
        specialties: ["botox", "filler", "laser", "lifting", "pico"],
        priceRange: "â‚©â‚©â‚©",
        popular: "Premium Botox, Rejuran",
        lat: 37.5200,
        lng: 127.0474,
        naverPlaceId: "1855076137",
        englishOk: true
    },
    {
        name: "Made Young Clinic",
        korean: "ë©”ì´ë“œì˜ì˜ì›",
        area: "Gangnam Station",
        areaKr: "ê°•ë‚¨ì—­",
        rating: 4.5,
        reviews: 156,
        specialties: ["laser", "skinbooster", "botox", "aquapeel"],
        priceRange: "â‚©",
        popular: "Affordable Laser, Aqua Peel",
        lat: 37.4982,
        lng: 127.0287,
        naverPlaceId: "1102752374",
        englishOk: false
    },
    {
        name: "Hus-hu Dermatology",
        korean: "í—ˆìŠ¤í—ˆí”¼ë¶€ê³¼",
        area: "Sinsa",
        areaKr: "ì‹ ì‚¬",
        rating: 4.7,
        reviews: 289,
        specialties: ["laser", "skinbooster", "pico", "aquapeel"],
        priceRange: "â‚©â‚©",
        popular: "Laser Toning, Skin Booster",
        lat: 37.5160,
        lng: 127.0200,
        naverPlaceId: "1583928504",
        englishOk: true
    },
    {
        name: "Banobagi Plastic Surgery",
        korean: "ë°”ë…¸ë°”ê¸°ì„±í˜•ì™¸ê³¼",
        area: "Gangnam",
        areaKr: "ê°•ë‚¨",
        rating: 4.6,
        reviews: 743,
        specialties: ["botox", "filler", "lifting", "thread"],
        priceRange: "â‚©â‚©â‚©",
        popular: "Botox, Filler, Thread Lift",
        lat: 37.5010,
        lng: 127.0396,
        naverPlaceId: "11592061",
        englishOk: true
    },
    {
        name: "Dermaline",
        korean: "ë”ë§ˆë¼ì¸í”¼ë¶€ê³¼",
        area: "Gangnam",
        areaKr: "ê°•ë‚¨",
        rating: 4.8,
        reviews: 412,
        specialties: ["laser", "pico", "skinbooster", "botox"],
        priceRange: "â‚©â‚©",
        popular: "Pico Laser, Skin Booster",
        lat: 37.4985,
        lng: 127.0305,
        naverPlaceId: "1178498498",
        englishOk: true
    },
    {
        name: "Cheongdam Star Clinic",
        korean: "ì²­ë‹´ìŠ¤íƒ€ì˜ì›",
        area: "Cheongdam",
        areaKr: "ì²­ë‹´",
        rating: 4.7,
        reviews: 198,
        specialties: ["botox", "filler", "lifting", "skinbooster"],
        priceRange: "â‚©â‚©â‚©",
        popular: "Premium Botox, Lifting",
        lat: 37.5215,
        lng: 127.0480,
        naverPlaceId: "1100252105",
        englishOk: true
    },
    {
        name: "Yonsei Star Dermatology",
        korean: "ì—°ì„¸ìŠ¤íƒ€í”¼ë¶€ê³¼",
        area: "Sinsa",
        areaKr: "ì‹ ì‚¬",
        rating: 4.6,
        reviews: 267,
        specialties: ["laser", "pico", "skinbooster", "aquapeel"],
        priceRange: "â‚©â‚©",
        popular: "Pico Laser, Aqua Peel",
        lat: 37.5165,
        lng: 127.0210,
        naverPlaceId: "1947483245",
        englishOk: true
    }
];

// Procedures Data
var proceduresData = [
    { english: "Botox", korean: "ë³´í†¡ìŠ¤", description: "Relaxes facial muscles to reduce wrinkles.", priceKRW: "â‚©50,000 - â‚©200,000", priceUSD: "$40 - $150", duration: "10-15 min", downtime: "None", lasts: "3-6 months", rank: "#1 Popular", tags: ["Anti-wrinkle", "Prevention", "Quick"] },
    { english: "Rejuran", korean: "ë¦¬ì¥¬ë€", description: "Salmon DNA injections for skin regeneration.", priceKRW: "â‚©150,000 - â‚©300,000", priceUSD: "$115 - $230", duration: "30-40 min", downtime: "1-2 days", lasts: "6-12 months", rank: "#2 Popular", tags: ["Regeneration", "Anti-aging"] },
    { english: "Ultherapy", korean: "ìš¸ì„ë¼", description: "Non-invasive ultrasound treatment for lifting.", priceKRW: "â‚©500,000 - â‚©2,000,000", priceUSD: "$380 - $1,500", duration: "60-90 min", downtime: "None", lasts: "1-2 years", rank: "#3 Popular", tags: ["Lifting", "Tightening"] },
    { english: "Skin Booster", korean: "ë¬¼ê´‘ì£¼ì‚¬", description: "Micro-injections for glass skin glow.", priceKRW: "â‚©150,000 - â‚©350,000", priceUSD: "$115 - $270", duration: "30-45 min", downtime: "1-3 days", lasts: "4-6 months", rank: "#4 Popular", tags: ["Glass Skin", "Hydration"] },
    { english: "Laser Toning", korean: "ë ˆì´ì €í† ë‹", description: "Gentle laser for even skin tone.", priceKRW: "â‚©50,000 - â‚©150,000", priceUSD: "$40 - $115", duration: "15-30 min", downtime: "None", lasts: "Cumulative", rank: "#5 Popular", tags: ["Brightening", "Pores"] },
    { english: "Dermal Filler", korean: "í•„ëŸ¬", description: "Injectable gel for volume and contouring.", priceKRW: "â‚©200,000 - â‚©500,000", priceUSD: "$150 - $380", duration: "15-30 min", downtime: "1-3 days", lasts: "6-18 months", rank: "#6 Popular", tags: ["Contouring", "Volume"] },
    { english: "Shrink (HIFU)", korean: "ì‰¬ë§í¬", description: "High-intensity focused ultrasound for skin tightening. A more affordable alternative to Ultherapy.", priceKRW: "â‚©100,000 - â‚©500,000", priceUSD: "$75 - $380", duration: "30-60 min", downtime: "None", lasts: "6-12 months", rank: "#7 Popular", tags: ["Lifting", "Tightening", "Affordable"] },
    { english: "Pico Laser", korean: "í”¼ì½”ë ˆì´ì €", description: "Ultra-short pulse laser for pigmentation, acne scars, and skin rejuvenation.", priceKRW: "â‚©80,000 - â‚©300,000", priceUSD: "$60 - $230", duration: "15-30 min", downtime: "1-3 days", lasts: "Cumulative", rank: "#8 Popular", tags: ["Pigmentation", "Acne Scars", "Brightening"] },
    { english: "Thread Lift", korean: "ì‹¤ë¦¬í”„íŒ…", description: "Dissolvable threads inserted under skin for natural V-line lifting effect.", priceKRW: "â‚©300,000 - â‚©1,500,000", priceUSD: "$230 - $1,150", duration: "30-60 min", downtime: "3-7 days", lasts: "1-2 years", rank: "#9 Popular", tags: ["V-Line", "Lifting", "Contouring"] },
    { english: "Aqua Peel", korean: "ì•„ì¿ ì•„í•„", description: "Water-based exfoliation for deep pore cleansing and skin hydration. Great entry-level treatment.", priceKRW: "â‚©50,000 - â‚©150,000", priceUSD: "$40 - $115", duration: "30-45 min", downtime: "None", lasts: "2-4 weeks", rank: "#10 Popular", tags: ["Pores", "Hydration", "Beginner-Friendly"] }
];

// Personal Color Draping Data â€” 5 rounds of side-by-side color comparison
var drapingRounds = [
    {
        left:  { color: '#FFD700', label: 'Gold', korean: 'ê³¨ë“œ' },
        right: { color: '#C0C0C0', label: 'Silver', korean: 'ì‹¤ë²„' },
        leftScores:  { spring: 3, summer: 0, fall: 3, winter: 0 },
        rightScores: { spring: 0, summer: 3, fall: 0, winter: 3 }
    },
    {
        left:  { color: '#FF7F50', label: 'Coral', korean: 'ì½”ë„' },
        right: { color: '#FFB6C1', label: 'Rose Pink', korean: 'ë¡œì¦ˆí•‘í¬' },
        leftScores:  { spring: 3, summer: 0, fall: 1, winter: 0 },
        rightScores: { spring: 0, summer: 3, fall: 0, winter: 1 }
    },
    {
        left:  { color: '#FFDB58', label: 'Mustard', korean: 'ë¨¸ìŠ¤íƒ€ë“œ' },
        right: { color: '#E6E6FA', label: 'Lavender', korean: 'ë¼ë²¤ë”' },
        leftScores:  { spring: 1, summer: 0, fall: 3, winter: 0 },
        rightScores: { spring: 0, summer: 1, fall: 0, winter: 3 }
    },
    {
        left:  { color: '#FFFFF0', label: 'Ivory', korean: 'ì•„ì´ë³´ë¦¬' },
        right: { color: '#FFFFFF', label: 'Pure White', korean: 'í“¨ì–´í™”ì´íŠ¸' },
        leftScores:  { spring: 2, summer: 0, fall: 1, winter: 0 },
        rightScores: { spring: 0, summer: 1, fall: 0, winter: 2 }
    },
    {
        left:  { color: '#800020', label: 'Burgundy', korean: 'ë²„ê±´ë””' },
        right: { color: '#4169E1', label: 'Royal Blue', korean: 'ë¡œì—´ë¸”ë£¨' },
        leftScores:  { spring: 1, summer: 0, fall: 3, winter: 0 },
        rightScores: { spring: 0, summer: 1, fall: 0, winter: 3 }
    }
];

var personalColorResults = {
    spring: {
        emoji: "ğŸŒ¸",
        english: "Spring Warm",
        korean: "ë´„ ì›œí†¤",
        subtitle: "Warm & Bright",
        description: "You radiate warmth and brightness! Your skin glows with warm undertones and you look best in fresh, vibrant colors that reflect sunlight.",
        bestColors: [
            { name: "Coral", hex: "#FF7F50" },
            { name: "Peach", hex: "#FFDAB9" },
            { name: "Warm Yellow", hex: "#FFD700" },
            { name: "Light Green", hex: "#90EE90" },
            { name: "Salmon Pink", hex: "#FA8072" },
            { name: "Ivory", hex: "#FFFFF0" }
        ],
        worstColors: [
            { name: "Black", hex: "#000000" },
            { name: "Dark Gray", hex: "#444444" },
            { name: "Burgundy", hex: "#800020" }
        ],
        tips: [
            "Choose warm, clear colors over muted tones",
            "Gold jewelry enhances your natural glow",
            "Peach and coral blush suits you perfectly",
            "Avoid heavy, dark makeup â€” keep it fresh",
            "Warm brown and caramel hair tones are ideal"
        ],
        celebs: ["Yoona (SNSD)", "Suzy (Miss A)"],
        makeup: { foundation: "Warm beige", lip: "Coral, peach", blush: "Apricot", eye: "Warm brown, gold shimmer" }
    },
    summer: {
        emoji: "ğŸŒŠ",
        english: "Summer Cool",
        korean: "ì—¬ë¦„ ì¿¨í†¤",
        subtitle: "Cool & Soft",
        description: "You have a soft, elegant aura with cool undertones. Muted, powdery colors complement your gentle complexion beautifully.",
        bestColors: [
            { name: "Lavender", hex: "#E6E6FA" },
            { name: "Powder Blue", hex: "#B0E0E6" },
            { name: "Rose Pink", hex: "#FFB6C1" },
            { name: "Mauve", hex: "#E0B0FF" },
            { name: "Soft Gray", hex: "#C0C0C0" },
            { name: "Dusty Rose", hex: "#DCAE96" }
        ],
        worstColors: [
            { name: "Orange", hex: "#FF8C00" },
            { name: "Mustard", hex: "#FFDB58" },
            { name: "Olive Green", hex: "#808000" }
        ],
        tips: [
            "Soft, muted tones look better than bold ones",
            "Silver and rose gold jewelry suit you best",
            "Pink-toned blush and lip colors are your go-to",
            "Ash or cool brown hair tones are flattering",
            "Avoid overly warm or earthy makeup shades"
        ],
        celebs: ["IU", "Kim Taehee"],
        makeup: { foundation: "Pink beige", lip: "Rose pink, mauve", blush: "Soft pink", eye: "Taupe, lavender" }
    },
    fall: {
        emoji: "ğŸ‚",
        english: "Fall Warm",
        korean: "ê°€ì„ ì›œí†¤",
        subtitle: "Warm & Deep",
        description: "You have a rich, earthy warmth. Deep, muted warm tones bring out your natural depth and make you look stunning.",
        bestColors: [
            { name: "Terracotta", hex: "#E2725B" },
            { name: "Olive", hex: "#808000" },
            { name: "Mustard", hex: "#FFDB58" },
            { name: "Burgundy", hex: "#800020" },
            { name: "Camel", hex: "#C19A6B" },
            { name: "Chocolate", hex: "#7B3F00" }
        ],
        worstColors: [
            { name: "Pastel Pink", hex: "#FFB6C1" },
            { name: "Bright Blue", hex: "#0000FF" },
            { name: "Neon Colors", hex: "#39FF14" }
        ],
        tips: [
            "Rich, earthy tones are your signature look",
            "Antique gold and bronze jewelry look amazing",
            "Warm brown and terracotta lip colors are ideal",
            "Deep auburn or chestnut hair tones suit you",
            "Layer warm neutrals for a polished look"
        ],
        celebs: ["Jennie (BLACKPINK)", "Song Hyekyo"],
        makeup: { foundation: "Golden beige", lip: "Brick red, terracotta", blush: "Peach brown", eye: "Copper, olive" }
    },
    winter: {
        emoji: "â„ï¸",
        english: "Winter Cool",
        korean: "ê²¨ìš¸ ì¿¨í†¤",
        subtitle: "Cool & Vivid",
        description: "You have a striking, high-contrast appearance. Bold, vivid colors and sharp contrasts make you look powerful and chic.",
        bestColors: [
            { name: "Pure White", hex: "#FFFFFF" },
            { name: "True Red", hex: "#FF0000" },
            { name: "Royal Blue", hex: "#4169E1" },
            { name: "Emerald", hex: "#50C878" },
            { name: "Fuchsia", hex: "#FF00FF" },
            { name: "Black", hex: "#000000" }
        ],
        worstColors: [
            { name: "Beige", hex: "#F5F5DC" },
            { name: "Warm Orange", hex: "#FF8C00" },
            { name: "Muted Brown", hex: "#A0522D" }
        ],
        tips: [
            "Bold, high-contrast outfits look stunning on you",
            "Platinum and silver jewelry enhance your features",
            "Berry and wine lip colors are your power shades",
            "Cool black or blue-black hair is most flattering",
            "Don't be afraid of pure white and jet black"
        ],
        celebs: ["Jisoo (BLACKPINK)", "Jun Jihyun"],
        makeup: { foundation: "Neutral to cool", lip: "Berry, wine, true red", blush: "Cool pink", eye: "Charcoal, plum" }
    }
};

// Personal Color Draping State
var pcStream = null;
var pcIsMirrored = false;
var pcCapturedImageData = null;
var pcFaceCropData = null;
var pcCurrentRound = 0;
var pcScores = { spring: 0, summer: 0, fall: 0, winter: 0 };

function showPcScreen(screenId) {
    var screens = document.querySelectorAll('#pc-section .pc-screen');
    for (var i = 0; i < screens.length; i++) {
        screens[i].classList.add('hidden');
    }
    document.getElementById(screenId).classList.remove('hidden');
}

function showPcError(msg) {
    var el = document.getElementById('pc-cam-error');
    el.textContent = msg;
    el.classList.remove('hidden');
    setTimeout(function() { el.classList.add('hidden'); }, 5000);
}

async function startPCCamera() {
    showPcScreen('pc-camera');
    document.getElementById('pc-camera-controls').classList.remove('hidden');
    document.getElementById('pc-preview-controls').classList.add('hidden');
    document.getElementById('pc-cam-error').classList.add('hidden');
    document.getElementById('pc-face-guide').style.display = '';
    document.getElementById('pc-preview').style.display = 'none';

    var video = document.getElementById('pc-video');
    video.style.display = '';
    pcIsMirrored = true;

    try {
        pcStream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: 'user', width: { ideal: 640 }, height: { ideal: 480 } }
        });
        video.srcObject = pcStream;
    } catch (e) {
        stopPCCamera();
        showPcScreen('pc-start');
        var startCard = document.querySelector('#pc-start .pc-start-card');
        var existingErr = startCard.querySelector('.fs-error');
        if (!existingErr) {
            var errP = document.createElement('p');
            errP.className = 'fs-error';
            errP.textContent = 'Camera not available. Please use image upload. ì¹´ë©”ë¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.';
            startCard.appendChild(errP);
            setTimeout(function() { errP.remove(); }, 5000);
        }
    }
}

function stopPCCamera() {
    if (pcStream) {
        var tracks = pcStream.getTracks();
        for (var i = 0; i < tracks.length; i++) {
            tracks[i].stop();
        }
        pcStream = null;
    }
}

function capturePCPhoto() {
    var video = document.getElementById('pc-video');
    var canvas = document.getElementById('pc-canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    var ctx = canvas.getContext('2d');
    if (pcIsMirrored) {
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
    }
    ctx.drawImage(video, 0, 0);
    ctx.setTransform(1, 0, 0, 1, 0, 0);

    stopPCCamera();
    var dataUrl = canvas.toDataURL('image/jpeg', 0.9);
    var preview = document.getElementById('pc-preview');
    preview.src = dataUrl;
    preview.style.display = '';
    video.style.display = 'none';
    document.getElementById('pc-face-guide').style.display = 'none';
    document.getElementById('pc-camera-controls').classList.add('hidden');
    document.getElementById('pc-preview-controls').classList.remove('hidden');
    pcCapturedImageData = dataUrl;
}

function triggerPCUpload() {
    document.getElementById('pc-file-input').click();
}

function handlePCUpload(event) {
    var file = event.target.files[0];
    if (!file) return;
    if (!file.type.startsWith('image/')) {
        showPcError('Please upload an image file. ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
        return;
    }
    if (file.size > 10 * 1024 * 1024) {
        showPcError('File is too large (max 10MB). íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤ (ìµœëŒ€ 10MB).');
        return;
    }

    pcIsMirrored = false;
    var reader = new FileReader();
    reader.onload = function(e) {
        pcCapturedImageData = e.target.result;
        showPcScreen('pc-camera');
        var preview = document.getElementById('pc-preview');
        preview.src = pcCapturedImageData;
        preview.style.display = '';
        document.getElementById('pc-video').style.display = 'none';
        document.getElementById('pc-face-guide').style.display = 'none';
        document.getElementById('pc-camera-controls').classList.add('hidden');
        document.getElementById('pc-preview-controls').classList.remove('hidden');
        document.getElementById('pc-cam-error').classList.add('hidden');
    };
    reader.readAsDataURL(file);
    event.target.value = '';
}

function retakePCPhoto() {
    pcCapturedImageData = null;
    pcFaceCropData = null;
    showPcScreen('pc-start');
    stopPCCamera();
}

function cancelPCCamera() {
    stopPCCamera();
    pcCapturedImageData = null;
    pcFaceCropData = null;
    showPcScreen('pc-start');
}

// Crop face from photo using MediaPipe landmarks (fallback: use original image)
async function cropFaceFromPhoto(imageDataUrl) {
    try {
        var landmarker = await initFaceLandmarker();
        var img = new Image();
        img.src = imageDataUrl;
        await new Promise(function(resolve, reject) {
            img.onload = resolve;
            img.onerror = reject;
        });
        var result = landmarker.detect(img);
        if (!result.faceLandmarks || result.faceLandmarks.length === 0) {
            return imageDataUrl; // fallback
        }
        var lm = result.faceLandmarks[0];
        var minX = 1, minY = 1, maxX = 0, maxY = 0;
        for (var i = 0; i < lm.length; i++) {
            if (lm[i].x < minX) minX = lm[i].x;
            if (lm[i].y < minY) minY = lm[i].y;
            if (lm[i].x > maxX) maxX = lm[i].x;
            if (lm[i].y > maxY) maxY = lm[i].y;
        }
        // Add padding (30%)
        var w = maxX - minX, h = maxY - minY;
        var pad = Math.max(w, h) * 0.3;
        minX = Math.max(0, minX - pad);
        minY = Math.max(0, minY - pad);
        maxX = Math.min(1, maxX + pad);
        maxY = Math.min(1, maxY + pad);
        // Make square
        var cx = (minX + maxX) / 2, cy = (minY + maxY) / 2;
        var side = Math.max(maxX - minX, maxY - minY);
        var half = side / 2;
        var sx = Math.max(0, cx - half), sy = Math.max(0, cy - half);
        var ex = Math.min(1, cx + half), ey = Math.min(1, cy + half);
        // Draw cropped face
        var canvas = document.createElement('canvas');
        var cropSize = 300;
        canvas.width = cropSize;
        canvas.height = cropSize;
        var ctx = canvas.getContext('2d');
        ctx.drawImage(img,
            sx * img.naturalWidth, sy * img.naturalHeight,
            (ex - sx) * img.naturalWidth, (ey - sy) * img.naturalHeight,
            0, 0, cropSize, cropSize
        );
        return canvas.toDataURL('image/jpeg', 0.9);
    } catch (e) {
        console.warn('Face crop failed, using original image:', e);
        return imageDataUrl;
    }
}

// Start draping after photo is captured
async function startDraping() {
    document.getElementById('pc-preview-controls').classList.add('hidden');
    // Show brief loading while cropping face
    var loadEl = document.createElement('div');
    loadEl.className = 'fs-loading';
    loadEl.innerHTML = '<div class="fs-spinner"></div><p>Preparing draping... ë“œë ˆì´í•‘ ì¤€ë¹„ ì¤‘...</p>';
    document.querySelector('.pc-camera-card').appendChild(loadEl);

    pcFaceCropData = await cropFaceFromPhoto(pcCapturedImageData);
    loadEl.remove();

    pcCurrentRound = 0;
    pcScores = { spring: 0, summer: 0, fall: 0, winter: 0 };
    renderDrapingRound();
    showPcScreen('pc-draping');
}

function renderDrapingRound() {
    var round = drapingRounds[pcCurrentRound];
    var progress = ((pcCurrentRound + 1) / drapingRounds.length) * 100;
    document.getElementById('draping-progress-fill').style.width = progress + '%';
    document.getElementById('draping-round-label').textContent = 'Round ' + (pcCurrentRound + 1) + ' / ' + drapingRounds.length;

    var html =
        '<button class="draping-option" onclick="selectDrapingOption(\'left\')">' +
            '<div class="draping-bg" style="background:' + round.left.color + ';' + (round.left.color === '#FFFFF0' || round.left.color === '#FFFFFF' ? 'border:1px solid #ddd;' : '') + '">' +
                '<div class="draping-face"><img src="' + pcFaceCropData + '" alt="Your face"></div>' +
            '</div>' +
            '<div class="draping-label">' + round.left.label + '<br><span class="korean">' + round.left.korean + '</span></div>' +
        '</button>' +
        '<div class="draping-vs">VS</div>' +
        '<button class="draping-option" onclick="selectDrapingOption(\'right\')">' +
            '<div class="draping-bg" style="background:' + round.right.color + ';' + (round.right.color === '#FFFFF0' || round.right.color === '#FFFFFF' ? 'border:1px solid #ddd;' : '') + '">' +
                '<div class="draping-face"><img src="' + pcFaceCropData + '" alt="Your face"></div>' +
            '</div>' +
            '<div class="draping-label">' + round.right.label + '<br><span class="korean">' + round.right.korean + '</span></div>' +
        '</button>';

    document.getElementById('draping-comparison').innerHTML = html;
}

function selectDrapingOption(side) {
    var round = drapingRounds[pcCurrentRound];
    var scores = side === 'left' ? round.leftScores : round.rightScores;
    pcScores.spring += scores.spring;
    pcScores.summer += scores.summer;
    pcScores.fall += scores.fall;
    pcScores.winter += scores.winter;

    // Animate the selected option
    var options = document.querySelectorAll('.draping-option');
    var selectedIdx = side === 'left' ? 0 : 1;
    options[selectedIdx].classList.add('draping-picked');

    setTimeout(function() {
        pcCurrentRound++;
        if (pcCurrentRound < drapingRounds.length) {
            renderDrapingRound();
        } else {
            showPcAnalyzing();
        }
    }, 500);
}

function showPcAnalyzing() {
    showPcScreen('pc-analyzing');
    setTimeout(function() {
        showPCResult();
    }, 1500);
}

function showPCResult() {
    showPcScreen('pc-result');

    var maxSeason = 'spring';
    var maxScore = 0;
    for (var season in pcScores) {
        if (pcScores[season] > maxScore) {
            maxScore = pcScores[season];
            maxSeason = season;
        }
    }

    var r = personalColorResults[maxSeason];

    var bestColorsHtml = '<div class="color-palette">';
    for (var i = 0; i < r.bestColors.length; i++) {
        var c = r.bestColors[i];
        bestColorsHtml += '<div class="color-swatch">' +
            '<div class="swatch-circle" style="background:' + c.hex + ';' + (c.hex === '#FFFFFF' ? 'border:2px solid #ddd;' : '') + '"></div>' +
            '<span class="swatch-name">' + c.name + '</span></div>';
    }
    bestColorsHtml += '</div>';

    var worstColorsHtml = '<div class="worst-colors"><h4>Colors to Avoid í”¼í•´ì•¼ í•  ì»¬ëŸ¬</h4><div class="color-palette">';
    for (var j = 0; j < r.worstColors.length; j++) {
        var w = r.worstColors[j];
        worstColorsHtml += '<div class="color-swatch">' +
            '<div class="swatch-circle" style="background:' + w.hex + ';"></div>' +
            '<span class="swatch-name">' + w.name + '</span></div>';
    }
    worstColorsHtml += '</div></div>';

    var tipsHtml = '';
    for (var k = 0; k < r.tips.length; k++) {
        tipsHtml += '<li>' + r.tips[k] + '</li>';
    }

    var celebsHtml = '<div class="celeb-section"><h4>Celebrity References ì°¸ê³  ì…€ëŸ½</h4>';
    for (var m = 0; m < r.celebs.length; m++) {
        celebsHtml += '<span class="celeb-item">' + r.celebs[m] + '</span>';
    }
    celebsHtml += '</div>';

    var makeupHtml = '<div class="makeup-guide"><h4>Makeup Guide ë©”ì´í¬ì—… ê°€ì´ë“œ</h4>' +
        '<div class="makeup-season"><strong>Foundation íŒŒìš´ë°ì´ì…˜</strong><p>' + r.makeup.foundation + '</p></div>' +
        '<div class="makeup-season"><strong>Lip ë¦½</strong><p>' + r.makeup.lip + '</p></div>' +
        '<div class="makeup-season"><strong>Blush ë¸”ëŸ¬ì…”</strong><p>' + r.makeup.blush + '</p></div>' +
        '<div class="makeup-season"><strong>Eye Shadow ì•„ì´ì„€ë„</strong><p>' + r.makeup.eye + '</p></div>' +
        '</div>';

    var seasonColors = { spring: '#FF7F50', summer: '#B0E0E6', fall: '#E2725B', winter: '#4169E1' };

    document.getElementById('pc-result-content').innerHTML =
        '<div class="result-emoji">' + r.emoji + '</div>' +
        '<h2 class="result-type">' + r.english + '</h2>' +
        '<p class="result-type-korean">' + r.korean + '</p>' +
        '<div class="season-result-badge" style="background:' + seasonColors[maxSeason] + ';">' + r.subtitle + '</div>' +
        '<div class="result-description"><h4>About Your Colors</h4><p>' + r.description + '</p>' +
        '<h4>Best Colors ë² ìŠ¤íŠ¸ ì»¬ëŸ¬</h4>' + bestColorsHtml +
        worstColorsHtml +
        '<h4>Styling Tips</h4><ul>' + tipsHtml + '</ul>' +
        makeupHtml +
        celebsHtml +
        '</div>' +
        '<button class="secondary-btn" onclick="retakePersonalColor()">Retake Test ë‹¤ì‹œí•˜ê¸°</button>';

    document.getElementById('pc-result-content').classList.add('animated');
    createConfetti();
}

function retakePersonalColor() {
    document.getElementById('pc-result-content').classList.remove('animated');
    pcCapturedImageData = null;
    pcFaceCropData = null;
    showPcScreen('pc-start');
}

// App State
var currentQuestion = 0;
var scores = { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 0 };
var selectedSeason = null;
var quizQuestions = summerQuizQuestions;

// Season Selection
function selectSeason(season) {
    selectedSeason = season;
    quizQuestions = (season === 'summer') ? summerQuizQuestions : winterQuizQuestions;

    var icon = (season === 'summer') ? 'â˜€ï¸' : 'â„ï¸';
    var title = (season === 'summer') ? 'Summer Skin Quiz' : 'Winter Skin Quiz';
    var subtitle = (season === 'summer') ? 'ì—¬ë¦„ í”¼ë¶€ í€´ì¦ˆ' : 'ê²¨ìš¸ í”¼ë¶€ í€´ì¦ˆ';

    document.getElementById('season-quiz-icon').textContent = icon;
    document.getElementById('season-quiz-title').textContent = title;
    document.getElementById('season-quiz-subtitle').textContent = subtitle;

    document.getElementById('quiz-season-select').classList.add('hidden');
    document.getElementById('quiz-start').classList.remove('hidden');
}

function backToSeasonSelect() {
    document.getElementById('quiz-start').classList.add('hidden');
    document.getElementById('quiz-season-select').classList.remove('hidden');
}

function startQuiz() {
    currentQuestion = 0;
    scores = { dry: 0, oily: 0, combination: 0, sensitive: 0, normal: 0 };
    document.getElementById('quiz-start').classList.add('hidden');
    document.getElementById('quiz-questions').classList.remove('hidden');
    renderQuestion();
}

function renderQuestion() {
    var q = quizQuestions[currentQuestion];
    var progress = ((currentQuestion + 1) / quizQuestions.length) * 100;

    document.getElementById('progress-fill').style.width = progress + '%';
    document.getElementById('progress-text').textContent = (currentQuestion + 1) + ' / ' + quizQuestions.length;

    var html = '<p class="question-text">' + q.english + '</p>' +
               '<p class="question-text-korean">' + q.korean + '</p>' +
               '<div class="options-list">';

    for (var i = 0; i < q.options.length; i++) {
        html += '<button class="option-btn" onclick="selectOption(' + i + ')">' +
                '<span class="english">' + q.options[i].english + '</span>' +
                '<span class="korean">' + q.options[i].korean + '</span></button>';
    }
    html += '</div>';
    document.getElementById('question-container').innerHTML = html;
}

function selectOption(idx) {
    var q = quizQuestions[currentQuestion];
    var s = q.options[idx].scores;
    scores.dry += s.dry;
    scores.oily += s.oily;
    scores.combination += s.combination;
    scores.sensitive += s.sensitive;
    scores.normal += s.normal;

    currentQuestion++;
    if (currentQuestion < quizQuestions.length) {
        renderQuestion();
    } else {
        showResult();
    }
}

function showResult() {
    document.getElementById('quiz-questions').classList.add('hidden');
    document.getElementById('quiz-result').classList.remove('hidden');

    var maxType = 'normal';
    var maxScore = 0;
    for (var type in scores) {
        if (scores[type] > maxScore) {
            maxScore = scores[type];
            maxType = type;
        }
    }

    var r = skinTypeResults[maxType];
    var seasonBadge = (selectedSeason === 'summer') ? 'â˜€ï¸ Summer Result' : 'â„ï¸ Winter Result';
    var seasonTip = (selectedSeason === 'summer')
        ? 'â˜€ï¸ Summer tip: Use lightweight products and reapply sunscreen!'
        : 'â„ï¸ Winter tip: Layer hydrating products and use occlusive creams!';

    var tipsHtml = '';
    for (var i = 0; i < r.tips.length; i++) {
        tipsHtml += '<li>' + r.tips[i] + '</li>';
    }

    var productsHtml = '';
    for (var j = 0; j < r.products.length; j++) {
        var p = r.products[j];
        productsHtml += '<div class="product-item"><span class="product-emoji">' + p.emoji + '</span>' +
                        '<div class="product-info"><span class="product-name">' + p.name + '</span>' +
                        '<span class="product-brand">' + p.brand + '</span></div></div>';
    }

    document.getElementById('result-content').innerHTML =
        '<div class="result-emoji">' + r.emoji + '</div>' +
        '<h2 class="result-type">' + r.english + '</h2>' +
        '<p class="result-type-korean">' + r.korean + '</p>' +
        '<div class="season-badge">' + seasonBadge + '</div>' +
        '<div class="result-description"><h4>About Your Skin</h4><p>' + r.description + '</p>' +
        '<div class="season-tip">' + seasonTip + '</div>' +
        '<h4>Care Tips</h4><ul>' + tipsHtml + '</ul></div>' +
        '<div class="recommended-products"><h4>ğŸ›’ Recommended Products</h4>' + productsHtml + '</div>' +
        '<button class="secondary-btn" onclick="retakeQuiz()">Retake Quiz ë‹¤ì‹œí•˜ê¸°</button>';

    document.getElementById('result-content').classList.add('animated');
    createConfetti();
}

function retakeQuiz() {
    document.getElementById('quiz-result').classList.add('hidden');
    document.getElementById('quiz-season-select').classList.remove('hidden');
    document.getElementById('result-content').classList.remove('animated');
}

function createConfetti() {
    var colors = ['#ff6b9d', '#c44569', '#ff9500', '#00bcd4', '#4caf50', '#ffeb3b'];
    var container = document.createElement('div');
    container.className = 'confetti-container';
    document.body.appendChild(container);

    for (var i = 0; i < 50; i++) {
        var c = document.createElement('div');
        c.className = 'confetti';
        c.style.left = Math.random() * 100 + '%';
        c.style.background = colors[Math.floor(Math.random() * colors.length)];
        c.style.animationDelay = Math.random() * 2 + 's';
        c.style.animationDuration = (Math.random() * 2 + 2) + 's';
        c.style.borderRadius = Math.random() > 0.5 ? '50%' : '0%';
        container.appendChild(c);
    }

    setTimeout(function() { container.remove(); }, 4000);
}

function renderProcedures() {
    var grid = document.getElementById('procedures-grid');
    if (!grid) return;

    var html = '';
    for (var i = 0; i < proceduresData.length; i++) {
        var p = proceduresData[i];
        var tagsHtml = '';
        for (var j = 0; j < p.tags.length; j++) {
            tagsHtml += '<span class="tag">' + p.tags[j] + '</span>';
        }
        html += '<div class="procedure-card" onclick="toggleProcedure(this)">' +
                '<div class="procedure-header"><div><div class="procedure-title">' + p.english + '</div>' +
                '<div class="procedure-title-korean">' + p.korean + '</div></div>' +
                '<div class="procedure-header-right"><span class="procedure-rank">' + p.rank + '</span>' +
                '<span class="procedure-chevron">&#9660;</span></div></div>' +
                '<div class="procedure-tags">' + tagsHtml + '</div>' +
                '<div class="procedure-body">' +
                '<p class="procedure-description">' + p.description + '</p>' +
                '<div class="procedure-details">' +
                '<div class="detail-item"><div class="detail-label">Price</div><div class="detail-value">' + p.priceKRW + '</div><div class="detail-value-sub">' + p.priceUSD + '</div></div>' +
                '<div class="detail-item"><div class="detail-label">Duration</div><div class="detail-value">' + p.duration + '</div></div>' +
                '<div class="detail-item"><div class="detail-label">Downtime</div><div class="detail-value">' + p.downtime + '</div></div>' +
                '<div class="detail-item"><div class="detail-label">Lasts</div><div class="detail-value">' + p.lasts + '</div></div></div>' +
                '</div></div>';
    }
    grid.innerHTML = html;
}

function toggleProcedure(card) {
    var isOpen = card.classList.contains('open');
    // Close all cards first
    var allCards = document.querySelectorAll('.procedure-card');
    for (var i = 0; i < allCards.length; i++) {
        allCards[i].classList.remove('open');
    }
    // Toggle clicked card
    if (!isOpen) {
        card.classList.add('open');
    }
}

function toggleSubAccordion(el) {
    event.stopPropagation();
    el.classList.toggle('open');
}

function switchRoutineTab(tab, e) {
    var btns = document.querySelectorAll('.routine-tab-btn');
    btns.forEach(function(btn) { btn.classList.remove('active'); });
    if (e && e.target) { e.target.classList.add('active'); }
    document.getElementById('routine-am').classList.toggle('hidden', tab !== 'am');
    document.getElementById('routine-pm').classList.toggle('hidden', tab !== 'pm');
}

function toggleContent(card) {
    var isOpen = card.classList.contains('open');
    // Close sibling cards in same section
    var parent = card.parentElement;
    var siblings = parent.querySelectorAll('.content-card');
    for (var i = 0; i < siblings.length; i++) {
        siblings[i].classList.remove('open');
    }
    if (!isOpen) {
        card.classList.add('open');
    }
}

function setupTabs() {
    var btns = document.querySelectorAll('.tab-btn');
    var panels = document.querySelectorAll('.tab-panel');

    for (var i = 0; i < btns.length; i++) {
        btns[i].addEventListener('click', function() {
            var tabId = this.getAttribute('data-tab');
            for (var j = 0; j < btns.length; j++) btns[j].classList.remove('active');
            for (var k = 0; k < panels.length; k++) panels[k].classList.add('hidden');
            this.classList.add('active');
            document.getElementById(tabId).classList.remove('hidden');
        });
    }
}

function renderClinics(filter) {
    var grid = document.getElementById('clinics-grid');
    if (!grid) return;

    var filtered = clinicsData;
    if (filter && filter !== 'all') {
        filtered = clinicsData.filter(function(c) {
            return c.specialties.indexOf(filter) !== -1;
        });
    }

    var html = '';
    for (var i = 0; i < filtered.length; i++) {
        var c = filtered[i];
        var stars = '';
        for (var s = 0; s < 5; s++) {
            stars += s < Math.floor(c.rating) ? 'â˜…' : 'â˜†';
        }

        var googleMapsUrl = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(c.korean + ' ' + c.areaKr);
        var naverMapUrl = 'https://map.naver.com/p/search/' + encodeURIComponent(c.korean);

        var googleReviewUrl = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(c.korean + ' ' + c.areaKr + ' ë¦¬ë·°');
        var englishBadge = c.englishOk ? '<span class="english-badge">EN</span>' : '';

        html += '<div class="clinic-card">' +
                '<div class="clinic-header">' +
                '<div class="clinic-name">' + c.name + englishBadge + '</div>' +
                '<div class="clinic-name-kr">' + c.korean + '</div>' +
                '</div>' +
                '<div class="clinic-location">ğŸ“ ' + c.area + ' ' + c.areaKr + '</div>' +
                '<div class="clinic-rating"><span class="stars">' + stars + '</span> ' + c.rating + ' <a href="' + googleReviewUrl + '" target="_blank" class="review-link" onclick="event.stopPropagation()">(' + c.reviews + ' reviews)</a></div>' +
                '<div class="clinic-popular">âœ¨ ' + c.popular + '</div>' +
                '<div class="clinic-price">' + c.priceRange + '</div>' +
                '<div class="clinic-maps">' +
                '<a href="' + googleMapsUrl + '" target="_blank" class="map-btn google-btn">Google Maps</a>' +
                '<a href="' + naverMapUrl + '" target="_blank" class="map-btn naver-btn">ë„¤ì´ë²„ ì§€ë„</a>' +
                '</div></div>';
    }
    grid.innerHTML = html;
}

function filterClinics(filter, e) {
    var btns = document.querySelectorAll('.clinic-filter .filter-btn');
    btns.forEach(function(btn) { btn.classList.remove('active'); });
    if (e && e.target) {
        e.target.classList.add('active');
    }
    renderClinics(filter);
}

function switchSubTab(tabId, e) {
    var btns = document.querySelectorAll('.sub-tab-btn');
    var panels = document.querySelectorAll('.sub-tab-panel');

    btns.forEach(function(btn) { btn.classList.remove('active'); });
    panels.forEach(function(panel) { panel.classList.add('hidden'); });

    if (e && e.target) {
        e.target.classList.add('active');
    }
    document.getElementById(tabId).classList.remove('hidden');
}

// Page Modal (About, Contact, Privacy)
var pageContent = {
    about: '<h2>About Glowmi</h2>' +
        '<p class="page-subtitle">Glowmi ì†Œê°œ</p>' +
        '<p>Glowmi (Glow + Me) is your personal K-Beauty companion, designed to help beginners navigate the world of Korean skincare and beauty. Whether you are exploring K-Beauty for the first time or planning a trip to Seoul for aesthetic treatments, our goal is to provide clear, accurate, and helpful information in both English and Korean.</p>' +
        '<h3>What We Offer</h3>' +
        '<ul>' +
        '<li><strong>Skin Type Quiz</strong> â€” An interactive quiz that analyzes your skin characteristics across different seasons to determine your skin type (dry, oily, combination, sensitive, or normal) with personalized K-Beauty product recommendations.</li>' +
        '<li><strong>Personal Color Test</strong> â€” A diagnostic tool that identifies your seasonal color type (Spring Warm, Summer Cool, Fall Warm, or Winter Cool) and provides your best color palette, styling tips, and makeup shade recommendations.</li>' +
        '<li><strong>Clinic Directory</strong> â€” A curated list of reputable dermatology clinics in the Gangnam, Sinsa, and Cheongdam areas of Seoul, including specialties, price ranges, ratings, and direct links to Google Maps and Naver Maps.</li>' +
        '<li><strong>Procedure Guide</strong> â€” Detailed information on the 10 most popular aesthetic procedures in Korea, including Botox, fillers, laser toning, and more, with pricing in both KRW and USD.</li>' +
        '<li><strong>Product Education</strong> â€” Comprehensive guides to the Korean 10-step skincare routine, popular ingredients, and beginner tips to help you build an effective routine.</li>' +
        '<li><strong>Wellness Content</strong> â€” Evidence-based information on how diet, sleep, stress, and daily habits affect skin health, featuring traditional Korean superfoods and wellness practices.</li>' +
        '</ul>' +
        '<h3>Our Mission</h3>' +
        '<p>We believe that skincare knowledge should be accessible to everyone. Korean beauty has transformed the global skincare industry with its innovation, affordability, and focus on prevention over correction. Glowmi bridges the language and knowledge gap so that anyone, regardless of background, can benefit from Korean beauty wisdom.</p>' +
        '<h3>Disclaimer</h3>' +
        '<p>The content on this site is for educational and informational purposes only. It is not intended as medical advice. Always consult a licensed dermatologist or healthcare professional before starting any new skincare treatment or aesthetic procedure. Individual results may vary based on skin type, health conditions, and other factors.</p>',

    contact: '<h2>Contact Us</h2>' +
        '<p class="page-subtitle">ë¬¸ì˜í•˜ê¸°</p>' +
        '<p>We value your feedback and are always looking to improve Glowmi. If you have questions, suggestions, corrections, or partnership inquiries, please reach out to us through the following channels:</p>' +
        '<div class="contact-info">' +
        '<div class="contact-item"><strong>Email</strong><p>support@glowmi.co</p></div>' +
        '<div class="contact-item"><strong>Response Time</strong><p>We typically respond within 48 hours during business days.</p></div>' +
        '</div>' +
        '<h3>Feedback</h3>' +
        '<p>Found incorrect information? Have a suggestion for a new feature? We appreciate all feedback that helps us serve the K-Beauty community better. Please include as much detail as possible in your message so we can address your inquiry effectively.</p>' +
        '<h3>Content Corrections</h3>' +
        '<p>We strive for accuracy in all our content, including clinic information, procedure details, and product recommendations. If you notice any outdated or incorrect information, please let us know and we will update it promptly.</p>',

    privacy: '<h2>Privacy Policy</h2>' +
        '<p class="page-subtitle">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</p>' +
        '<p><strong>Last updated:</strong> February 2026</p>' +
        '<p>Glowmi ("we," "our," or "us") respects your privacy and is committed to protecting your personal data. This Privacy Policy explains how we collect, use, and safeguard your information when you visit our website.</p>' +
        '<h3>1. Information We Collect</h3>' +
        '<p><strong>Quiz and Test Data:</strong> When you take our Skin Type Quiz or Personal Color Test, your answers are processed locally in your browser to generate results. We do not store your quiz responses on any server. All quiz data remains on your device and is cleared when you close or refresh the page.</p>' +
        '<p><strong>Automatically Collected Data:</strong> Like most websites, we may collect certain information automatically, including your IP address, browser type, device type, operating system, referring URLs, and pages visited. This data is collected through cookies and similar technologies for analytics purposes.</p>' +
        '<h3>2. How We Use Your Information</h3>' +
        '<p>We use collected information to: (a) provide and improve our services; (b) analyze website traffic and usage patterns; (c) display relevant advertisements through Google AdSense; and (d) ensure the security and functionality of our website.</p>' +
        '<h3>3. Google AdSense and Cookies</h3>' +
        '<p>We use Google AdSense to display advertisements on our website. Google AdSense uses cookies to serve ads based on your prior visits to our website and other websites on the Internet. Google\'s use of advertising cookies enables it and its partners to serve ads based on your visit to our site and other sites on the Internet. You may opt out of personalized advertising by visiting <a href="https://www.google.com/settings/ads" target="_blank" rel="noopener">Google Ads Settings</a>.</p>' +
        '<p>Third-party vendors, including Google, use cookies to serve ads based on your prior visits. You can opt out of third-party vendor cookies for personalized advertising by visiting <a href="https://www.aboutads.info/choices/" target="_blank" rel="noopener">www.aboutads.info</a>.</p>' +
        '<h3>4. Third-Party Links</h3>' +
        '<p>Our website contains links to external websites including Google Maps, Naver Maps, and clinic websites. We are not responsible for the privacy practices or content of these external sites. We encourage you to review the privacy policies of any third-party sites you visit.</p>' +
        '<h3>5. Data Security</h3>' +
        '<p>We implement appropriate technical and organizational measures to protect your personal data. However, no method of transmission over the Internet or electronic storage is completely secure, and we cannot guarantee absolute security.</p>' +
        '<h3>6. Children\'s Privacy</h3>' +
        '<p>Our website is not intended for children under the age of 13. We do not knowingly collect personal information from children under 13. If you are a parent or guardian and believe your child has provided us with personal information, please contact us.</p>' +
        '<h3>7. Your Rights</h3>' +
        '<p>Depending on your location, you may have the right to: (a) access the personal data we hold about you; (b) request correction or deletion of your data; (c) object to or restrict processing of your data; and (d) data portability. To exercise any of these rights, please contact us at the email address provided on our Contact page.</p>' +
        '<h3>8. Changes to This Policy</h3>' +
        '<p>We may update this Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page with an updated revision date. Your continued use of the website after any changes constitutes acceptance of the updated policy.</p>' +
        '<h3>9. Contact Us</h3>' +
        '<p>If you have questions about this Privacy Policy or our data practices, please contact us at support@glowmi.co.</p>'
};

function openPage(page) {
    document.getElementById('page-modal-body').innerHTML = pageContent[page];
    document.getElementById('page-modal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closePage() {
    document.getElementById('page-modal').classList.add('hidden');
    document.body.style.overflow = '';
}

// ===== Face Shape Detector =====
var fsFaceLandmarker = null;
var fsStream = null;
var fsIsMirrored = false;
var fsCapturedImageData = null;

var fsShapeData = {
    oval: {
        emoji: 'ğŸ¥š', name: 'Oval', korean: 'íƒ€ì›í˜•',
        description: 'Balanced proportions, slightly wider at cheekbones. Considered the most versatile shape â€” most styles work well.',
        tips: [
            'ğŸ’‡ Hair: Almost any hairstyle works! Try long layers or a classic bob.',
            'ğŸ‘“ Glasses: Most frame shapes suit you â€” experiment freely.',
            'ğŸ’„ Makeup: Light contouring on cheekbones to enhance your natural balance.',
            'ğŸ’ Accessories: Any earring style works â€” hoops, studs, or dangles.',
            'âœ‚ï¸ Bangs: Side-swept or curtain bangs complement your proportions.'
        ]
    },
    round: {
        emoji: 'ğŸŸ¢', name: 'Round', korean: 'ë‘¥ê·¼í˜•',
        description: 'Equal width and length with soft angles. Your full cheeks give a youthful appearance.',
        tips: [
            'ğŸ’‡ Hair: Layered cuts, side parts, and styles with volume on top elongate your face.',
            'ğŸ‘“ Glasses: Angular or rectangular frames add definition.',
            'ğŸ’„ Makeup: Contour along the sides of your face to create more angles.',
            'ğŸ’ Accessories: Long, dangling earrings help elongate visually.',
            'âœ‚ï¸ Bangs: Side-swept bangs or deep side parts work best. Avoid blunt, straight-across bangs.'
        ]
    },
    square: {
        emoji: 'ğŸ”·', name: 'Square', korean: 'ì‚¬ê°í˜•',
        description: 'Strong jawline with equal width at forehead, cheeks, and jaw. Your angular features give a bold, striking look.',
        tips: [
            'ğŸ’‡ Hair: Soft waves, layered cuts, or side-parted styles soften angular features.',
            'ğŸ‘“ Glasses: Round or oval frames balance your strong jawline.',
            'ğŸ’„ Makeup: Contour jaw corners and highlight the center of your face.',
            'ğŸ’ Accessories: Round earrings and curved necklaces complement your angles.',
            'âœ‚ï¸ Bangs: Soft, wispy bangs or side-swept styles work great.'
        ]
    },
    diamond: {
        emoji: 'ğŸ’', name: 'Diamond', korean: 'ë‹¤ì´ì•„ëª¬ë“œí˜•',
        description: 'Narrow forehead and jaw, widest at cheekbones. Your prominent cheekbones are your standout feature.',
        tips: [
            'ğŸ’‡ Hair: Side-swept bangs and chin-length cuts balance your wide cheekbones.',
            'ğŸ‘“ Glasses: Cat-eye or oval frames highlight your cheekbones beautifully.',
            'ğŸ’„ Makeup: Highlight forehead and chin, contour under cheekbones for balance.',
            'ğŸ’ Accessories: Small studs or short drop earrings work well.',
            'âœ‚ï¸ Bangs: Side-swept or curtain bangs add width to your forehead area.'
        ]
    },
    heart: {
        emoji: 'ğŸ’—', name: 'Heart', korean: 'í•˜íŠ¸í˜•',
        description: 'Wide forehead tapering to a narrow chin. Your face has a naturally sweet, inverted triangle shape.',
        tips: [
            'ğŸ’‡ Hair: Chin-length bobs or styles with volume below the ears balance your shape.',
            'ğŸ‘“ Glasses: Light, rimless frames or bottom-heavy frames work best.',
            'ğŸ’„ Makeup: Contour temples and highlight chin to create balance.',
            'ğŸ’ Accessories: Teardrop or chandelier earrings balance a narrow chin.',
            'âœ‚ï¸ Bangs: Soft, wispy bangs or curtain bangs minimize a wide forehead.'
        ]
    },
    long: {
        emoji: 'ğŸ“', name: 'Long (Oblong)', korean: 'ê¸´í˜•',
        description: 'Longer than wide with a long forehead or chin. Your elegant proportions give a sophisticated look.',
        tips: [
            'ğŸ’‡ Hair: Chin-length bobs, side parts, and horizontal layers add width.',
            'ğŸ‘“ Glasses: Wide, oversized frames or aviators add width to your face.',
            'ğŸ’„ Makeup: Apply blush horizontally across cheeks. Contour forehead and chin.',
            'ğŸ’ Accessories: Wide, chunky earrings add the illusion of width.',
            'âœ‚ï¸ Bangs: Full, straight-across bangs shorten and balance your face beautifully.'
        ]
    }
};

async function waitForMediaPipe(maxWait) {
    var start = Date.now();
    while (!window.FaceLandmarker || !window.FilesetResolver) {
        if (Date.now() - start > maxWait) {
            throw new Error('MediaPipe failed to load. Please refresh and try again.');
        }
        await new Promise(function(r) { setTimeout(r, 200); });
    }
}

async function initFaceLandmarker() {
    if (fsFaceLandmarker) return fsFaceLandmarker;

    await waitForMediaPipe(10000);

    var vision = await window.FilesetResolver.forVisionTasks(
        'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm'
    );

    // Try GPU first, fall back to CPU
    try {
        fsFaceLandmarker = await window.FaceLandmarker.createFromOptions(vision, {
            baseOptions: {
                modelAssetPath: 'https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task',
                delegate: 'GPU'
            },
            runningMode: 'IMAGE',
            numFaces: 1
        });
    } catch (gpuErr) {
        console.warn('GPU delegate failed, falling back to CPU:', gpuErr);
        fsFaceLandmarker = await window.FaceLandmarker.createFromOptions(vision, {
            baseOptions: {
                modelAssetPath: 'https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task',
                delegate: 'CPU'
            },
            runningMode: 'IMAGE',
            numFaces: 1
        });
    }
    return fsFaceLandmarker;
}

function showFsScreen(screenId) {
    var screens = document.querySelectorAll('#fs-section .fs-screen');
    for (var i = 0; i < screens.length; i++) {
        screens[i].classList.add('hidden');
    }
    document.getElementById(screenId).classList.remove('hidden');
}

function showFsError(msg) {
    var el = document.getElementById('fs-error');
    el.textContent = msg;
    el.classList.remove('hidden');
    setTimeout(function() { el.classList.add('hidden'); }, 5000);
}

async function startFaceCamera() {
    showFsScreen('fs-camera');
    document.getElementById('fs-camera-controls').classList.remove('hidden');
    document.getElementById('fs-preview-controls').classList.add('hidden');
    document.getElementById('fs-loading').classList.add('hidden');
    document.getElementById('fs-error').classList.add('hidden');
    document.getElementById('fs-face-guide').style.display = '';
    document.getElementById('fs-preview').style.display = 'none';

    var video = document.getElementById('fs-video');
    video.style.display = '';
    fsIsMirrored = true;

    try {
        fsStream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: 'user', width: { ideal: 640 }, height: { ideal: 480 } }
        });
        video.srcObject = fsStream;
    } catch (e) {
        stopFsCamera();
        showFsScreen('fs-start');
        showFsError('Camera access denied. Please use image upload instead. ì¹´ë©”ë¼ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.');
        // Show error on start screen too
        var startCard = document.querySelector('#fs-start .pc-start-card');
        var existingErr = startCard.querySelector('.fs-error');
        if (!existingErr) {
            var errP = document.createElement('p');
            errP.className = 'fs-error';
            errP.textContent = 'Camera not available. Please use image upload. ì¹´ë©”ë¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.';
            startCard.appendChild(errP);
            setTimeout(function() { errP.remove(); }, 5000);
        }
    }
}

function stopFsCamera() {
    if (fsStream) {
        var tracks = fsStream.getTracks();
        for (var i = 0; i < tracks.length; i++) {
            tracks[i].stop();
        }
        fsStream = null;
    }
}

function captureFacePhoto() {
    var video = document.getElementById('fs-video');
    var canvas = document.getElementById('fs-canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    var ctx = canvas.getContext('2d');
    if (fsIsMirrored) {
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
    }
    ctx.drawImage(video, 0, 0);
    ctx.setTransform(1, 0, 0, 1, 0, 0);

    stopFsCamera();
    var dataUrl = canvas.toDataURL('image/jpeg', 0.9);
    var preview = document.getElementById('fs-preview');
    preview.src = dataUrl;
    preview.style.display = '';
    video.style.display = 'none';
    document.getElementById('fs-face-guide').style.display = 'none';
    document.getElementById('fs-camera-controls').classList.add('hidden');
    document.getElementById('fs-preview-controls').classList.remove('hidden');
    fsCapturedImageData = dataUrl;
}

function triggerFaceUpload() {
    document.getElementById('fs-file-input').click();
}

function handleFaceUpload(event) {
    var file = event.target.files[0];
    if (!file) return;
    if (!file.type.startsWith('image/')) {
        showFsError('Please upload an image file. ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
        return;
    }
    if (file.size > 10 * 1024 * 1024) {
        showFsError('File is too large (max 10MB). íŒŒì¼ì´ ë„ˆë¬´ í½ë‹ˆë‹¤ (ìµœëŒ€ 10MB).');
        return;
    }

    fsIsMirrored = false;
    var reader = new FileReader();
    reader.onload = function(e) {
        fsCapturedImageData = e.target.result;
        showFsScreen('fs-camera');
        var preview = document.getElementById('fs-preview');
        preview.src = fsCapturedImageData;
        preview.style.display = '';
        document.getElementById('fs-video').style.display = 'none';
        document.getElementById('fs-face-guide').style.display = 'none';
        document.getElementById('fs-camera-controls').classList.add('hidden');
        document.getElementById('fs-preview-controls').classList.remove('hidden');
        document.getElementById('fs-loading').classList.add('hidden');
        document.getElementById('fs-error').classList.add('hidden');
    };
    reader.readAsDataURL(file);
    event.target.value = '';
}

function retakeFacePhoto() {
    fsCapturedImageData = null;
    showFsScreen('fs-start');
    stopFsCamera();
}

function cancelFaceDetection() {
    stopFsCamera();
    fsCapturedImageData = null;
    showFsScreen('fs-start');
}

async function analyzeFaceShape() {
    document.getElementById('fs-preview-controls').classList.add('hidden');
    document.getElementById('fs-loading').classList.remove('hidden');
    document.getElementById('fs-error').classList.add('hidden');

    try {
        var landmarker = await initFaceLandmarker();

        var img = new Image();
        img.src = fsCapturedImageData;
        await new Promise(function(resolve, reject) {
            img.onload = resolve;
            img.onerror = reject;
        });

        var result = landmarker.detect(img);

        if (!result.faceLandmarks || result.faceLandmarks.length === 0) {
            document.getElementById('fs-loading').classList.add('hidden');
            document.getElementById('fs-preview-controls').classList.remove('hidden');
            showFsError('No face detected. Please try again with a clearer photo. ì–¼êµ´ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë” ì„ ëª…í•œ ì‚¬ì§„ìœ¼ë¡œ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            return;
        }

        var landmarks = result.faceLandmarks[0];
        var shape = classifyFaceShape(landmarks);
        showFsResult(shape);
    } catch (e) {
        document.getElementById('fs-loading').classList.add('hidden');
        document.getElementById('fs-preview-controls').classList.remove('hidden');
        console.error('Face analysis error:', e);
        var msg = (e.message && e.message.indexOf('MediaPipe') !== -1)
            ? 'AI model is loading. Please wait a moment and try again. AI ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
            : 'Analysis failed. Please try again. ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        showFsError(msg);
    }
}

function classifyFaceShape(landmarks) {
    // Key landmark indices (MediaPipe 468 points)
    // Forehead top: 10, Chin bottom: 152
    // Left face: 234, Right face: 454
    // Left forehead: 67, Right forehead: 297
    // Left jaw: 172, Right jaw: 397
    // Left cheek: 116, Right cheek: 345
    // Jaw angle left: 132, Jaw angle right: 361

    var p = landmarks;
    var faceHeight = dist(p[10], p[152]);
    var faceWidth = dist(p[234], p[454]);
    var foreheadWidth = dist(p[67], p[297]);
    var jawWidth = dist(p[172], p[397]);
    var cheekWidth = dist(p[116], p[345]);

    // Jaw angle (how angular the jaw is)
    var jawLeft = p[132];
    var jawRight = p[361];
    var chin = p[152];
    var jawAngleLeft = angleBetween(p[234], jawLeft, chin);
    var jawAngleRight = angleBetween(p[454], jawRight, chin);
    var avgJawAngle = (jawAngleLeft + jawAngleRight) / 2;

    // Ratios
    var lengthWidthRatio = faceHeight / faceWidth;
    var foreheadJawRatio = foreheadWidth / jawWidth;
    var cheekFaceRatio = cheekWidth / faceWidth;

    // Scoring system
    var scores = { oval: 0, round: 0, square: 0, diamond: 0, heart: 0, long: 0 };

    // Length/width ratio analysis
    if (lengthWidthRatio > 1.55) {
        scores.long += 35;
        scores.oval += 10;
    } else if (lengthWidthRatio > 1.35) {
        scores.oval += 30;
        scores.diamond += 15;
        scores.heart += 10;
    } else if (lengthWidthRatio > 1.15) {
        scores.oval += 15;
        scores.square += 20;
        scores.round += 15;
    } else {
        scores.round += 35;
        scores.square += 15;
    }

    // Forehead/jaw ratio analysis
    if (foreheadJawRatio > 1.25) {
        scores.heart += 30;
        scores.diamond += 10;
    } else if (foreheadJawRatio > 1.05) {
        scores.oval += 15;
        scores.heart += 15;
    } else if (foreheadJawRatio > 0.9) {
        scores.square += 20;
        scores.round += 15;
        scores.oval += 10;
    } else {
        scores.square += 15;
        scores.round += 10;
    }

    // Cheekbone prominence
    if (cheekFaceRatio > 0.95) {
        scores.diamond += 25;
        scores.round += 10;
    } else if (cheekFaceRatio > 0.85) {
        scores.oval += 15;
        scores.round += 10;
    } else {
        scores.long += 10;
        scores.square += 5;
    }

    // Jaw angle analysis
    if (avgJawAngle > 155) {
        scores.square += 25;
    } else if (avgJawAngle > 140) {
        scores.square += 15;
        scores.oval += 10;
    } else if (avgJawAngle > 120) {
        scores.oval += 15;
        scores.round += 10;
    } else {
        scores.heart += 15;
        scores.diamond += 10;
    }

    // Find the highest score
    var maxShape = 'oval';
    var maxScore = 0;
    var totalScore = 0;
    var keys = Object.keys(scores);
    for (var i = 0; i < keys.length; i++) {
        totalScore += scores[keys[i]];
        if (scores[keys[i]] > maxScore) {
            maxScore = scores[keys[i]];
            maxShape = keys[i];
        }
    }

    var confidence = Math.min(Math.round((maxScore / totalScore) * 100 * 1.5), 95);
    confidence = Math.max(confidence, 55);

    return { shape: maxShape, confidence: confidence, scores: scores };
}

function dist(a, b) {
    var dx = a.x - b.x;
    var dy = a.y - b.y;
    return Math.sqrt(dx * dx + dy * dy);
}

function angleBetween(a, b, c) {
    var ab = { x: a.x - b.x, y: a.y - b.y };
    var cb = { x: c.x - b.x, y: c.y - b.y };
    var dot = ab.x * cb.x + ab.y * cb.y;
    var magAB = Math.sqrt(ab.x * ab.x + ab.y * ab.y);
    var magCB = Math.sqrt(cb.x * cb.x + cb.y * cb.y);
    var cosAngle = dot / (magAB * magCB);
    cosAngle = Math.max(-1, Math.min(1, cosAngle));
    return Math.acos(cosAngle) * (180 / Math.PI);
}

function showFsResult(result) {
    var data = fsShapeData[result.shape];
    var tipsHtml = '';
    for (var i = 0; i < data.tips.length; i++) {
        tipsHtml += '<li>' + data.tips[i] + '</li>';
    }

    // Build all shapes reference grid
    var shapesRefHtml = '<div class="fs-ref-grid">';
    var shapeKeys = Object.keys(fsShapeData);
    for (var j = 0; j < shapeKeys.length; j++) {
        var s = fsShapeData[shapeKeys[j]];
        var isActive = shapeKeys[j] === result.shape ? ' fs-ref-active' : '';
        shapesRefHtml += '<div class="fs-ref-item' + isActive + '">' +
            '<span class="face-shape-icon">' + s.emoji + '</span>' +
            '<strong>' + s.name + ' ' + s.korean + '</strong>' +
            '<p>' + s.description + '</p></div>';
    }
    shapesRefHtml += '</div>';

    document.getElementById('fs-result-content').innerHTML =
        '<div class="result-emoji">' + data.emoji + '</div>' +
        '<h2 class="result-type">' + data.name + ' Face</h2>' +
        '<p class="result-type-korean">' + data.korean + '</p>' +
        '<div class="fs-confidence">Confidence ì‹ ë¢°ë„: ' + result.confidence + '%</div>' +
        '<div class="result-description"><h4>About Your Face Shape</h4><p>' + data.description + '</p>' +
        '<h4>Styling Tips ìŠ¤íƒ€ì¼ë§ íŒ</h4><ul>' + tipsHtml + '</ul></div>' +
        '<div class="fs-ref-section"><h4>All Face Shapes ì „ì²´ ì–¼êµ´í˜• ê°€ì´ë“œ</h4>' + shapesRefHtml + '</div>' +
        '<div class="fs-result-buttons">' +
        '<button class="primary-btn" onclick="retryFaceShape()">ğŸ”„ Try Again ë‹¤ì‹œí•˜ê¸°</button>' +
        '</div>';

    showFsScreen('fs-result');
    document.getElementById('fs-result-content').classList.add('animated');
    createConfetti();
}

function retryFaceShape() {
    fsCapturedImageData = null;
    document.getElementById('fs-result-content').classList.remove('animated');
    showFsScreen('fs-start');
}

// ========== Ingredient Label Scanner (inline in Analyzer) ==========
var iaStream = null;
var iaCapturedImageData = null;

function showIaError(msg) {
    var el = document.getElementById('ia-cam-error');
    el.textContent = msg;
    el.classList.remove('hidden');
    setTimeout(function() { el.classList.add('hidden'); }, 5000);
}

function stopIACamera() {
    if (iaStream) {
        var tracks = iaStream.getTracks();
        for (var i = 0; i < tracks.length; i++) { tracks[i].stop(); }
        iaStream = null;
    }
}

async function openIACamera() {
    var area = document.getElementById('ia-scan-area');
    area.classList.remove('hidden');
    document.getElementById('ia-camera-controls').classList.remove('hidden');
    document.getElementById('ia-preview-controls').classList.add('hidden');
    document.getElementById('ia-cam-error').classList.add('hidden');
    document.getElementById('ia-scan-guide').style.display = '';
    document.getElementById('ia-preview').style.display = 'none';

    var video = document.getElementById('ia-video');
    video.style.display = '';

    try {
        iaStream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 960 } }
        });
        video.srcObject = iaStream;
        area.scrollIntoView({ behavior: 'smooth', block: 'center' });
    } catch (e) {
        stopIACamera();
        area.classList.add('hidden');
        showIaError('Camera not available. Use Upload Label instead. ì¹´ë©”ë¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
}

function captureIAPhoto() {
    var video = document.getElementById('ia-video');
    var canvas = document.getElementById('ia-canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    var ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0);

    stopIACamera();
    var dataUrl = canvas.toDataURL('image/jpeg', 0.92);
    var preview = document.getElementById('ia-preview');
    preview.src = dataUrl;
    preview.style.display = '';
    video.style.display = 'none';
    document.getElementById('ia-scan-guide').style.display = 'none';
    document.getElementById('ia-camera-controls').classList.add('hidden');
    document.getElementById('ia-preview-controls').classList.remove('hidden');
    iaCapturedImageData = dataUrl;
}

function triggerIAUpload() {
    document.getElementById('ia-file-input').click();
}

function handleIAUpload(event) {
    var file = event.target.files[0];
    if (!file) return;
    if (!file.type.startsWith('image/')) return;
    if (file.size > 10 * 1024 * 1024) return;

    var reader = new FileReader();
    reader.onload = function(e) {
        iaCapturedImageData = e.target.result;
        // Show preview inline
        var area = document.getElementById('ia-scan-area');
        area.classList.remove('hidden');
        var preview = document.getElementById('ia-preview');
        preview.src = iaCapturedImageData;
        preview.style.display = '';
        document.getElementById('ia-video').style.display = 'none';
        document.getElementById('ia-scan-guide').style.display = 'none';
        document.getElementById('ia-camera-controls').classList.add('hidden');
        document.getElementById('ia-preview-controls').classList.remove('hidden');
        area.scrollIntoView({ behavior: 'smooth', block: 'center' });
    };
    reader.readAsDataURL(file);
    event.target.value = '';
}

function retakeIAPhoto() {
    iaCapturedImageData = null;
    stopIACamera();
    document.getElementById('ia-scan-area').classList.add('hidden');
}

function closeIACamera() {
    stopIACamera();
    iaCapturedImageData = null;
    document.getElementById('ia-scan-area').classList.add('hidden');
}

function parseOCRText(text) {
    var normalized = text.replace(/[\r\n\t]+/g, ', ').replace(/\s{2,}/g, ' ');
    var parts = normalized.split(/[,;/Â·â€¢|]+/);
    var names = [];
    for (var i = 0; i < parts.length; i++) {
        var cleaned = parts[i].trim()
            .replace(/^\d+[\.\)]\s*/, '')
            .replace(/\(\d+%?\)/g, '')
            .replace(/[^\w\s\-\(\)ê°€-í£ã„±-ã…ã…-ã…£Ã©Ã¨ÃªÃ«Ã Ã¢Ã¤Ã¹Ã»Ã¼Ã´Ã¶Ã®Ã¯Ã§Ã±]/g, '')
            .trim();
        if (cleaned.length >= 3 && cleaned.length <= 80) {
            names.push(cleaned);
        }
    }
    return names;
}

async function scanIngredients() {
    if (!iaCapturedImageData) return;

    // Hide camera area, show progress inline
    document.getElementById('ia-scan-area').classList.add('hidden');
    var progressArea = document.getElementById('ia-scan-progress');
    var statusEl = document.getElementById('ia-scan-status');
    var progressFill = document.getElementById('ia-progress-fill');
    progressArea.classList.remove('hidden');
    statusEl.textContent = 'Initializing OCR...';
    progressFill.style.width = '10%';

    try {
        var result = await Tesseract.recognize(iaCapturedImageData, 'eng+kor', {
            logger: function(m) {
                if (m.status === 'recognizing text') {
                    var pct = Math.round(m.progress * 100);
                    progressFill.style.width = Math.max(10, pct) + '%';
                    statusEl.textContent = 'Scanning... ' + pct + '%';
                }
            }
        });

        progressArea.classList.add('hidden');
        var ocrText = result.data.text;

        if (!ocrText || ocrText.trim().length < 5) {
            showIaError('Could not read text. Try a clearer photo. í…ìŠ¤íŠ¸ë¥¼ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }

        // Parse and fill the textarea so user can review/edit
        var ingredientNames = parseOCRText(ocrText);
        var textarea = document.getElementById('analyzer-input');
        textarea.value = ingredientNames.join(', ');
        textarea.scrollIntoView({ behavior: 'smooth', block: 'center' });

        // Auto-analyze
        iaCapturedImageData = null;
        analyzeIngredients();

    } catch (err) {
        progressArea.classList.add('hidden');
        showIaError('Scan failed: ' + err.message);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    setupTabs();
    renderProcedures();
    renderClinics('all');
});
    </script>
</body>
</html>
